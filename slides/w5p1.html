<!DOCTYPE html>
<html>
  <head>
    <title>Parellel Iterations</title>
    <meta charset="utf-8">
    <meta name="author" content="Daniel Anderson" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/uo.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/uo-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Parellel Iterations
## And a few additional {purrr} functions
### Daniel Anderson
### Week 5, Class 1

---




# Agenda
* Finish up slides from Wednesday

* Discuss `map2_*` and `pmap_*`

* Introduce `walk`, `reduce` and `safely`

---
# Learning objectives
* Understand the differences between `map`, `map2`, and `pmap`

* Know when to apply `walk` instead of `map`, and why it may be useful

* Be able to collapse lists with `reduce`

* Diagnose errors with `safely` (and understand other situations where it may
be helpful)

---
class: inverse
background-image:url(https://d33wubrfki0l68.cloudfront.net/7a545699ff7069a98329fcfbe6e42b734507eb16/211a5/diagrams/functionals/map2-arg.png)
background-size:contain
# `map2`

---
class: inverse center middle

# A few Examples
Basic simulations - iterating over two vectors

Plots by month, changing the title

---
# Simulation
* Simulate data from a normal distribution
	+ Vary `\(n\)` from 5 to 150 by increments of 5
	+ For each `\(n\)`, vary `\(mu\)` from -2 to 2 by increments of 0.25


--
### How do we get all combinations

--
`expand.grid`

---
# Example `expand.grid`
### Bonus: It turns it into a data frame!

```r
ints &lt;- 1:3
lets &lt;- c("a", "b", "c")
expand.grid(ints, lets)
```

```
##   Var1 Var2
## 1    1    a
## 2    2    a
## 3    3    a
## 4    1    b
## 5    2    b
## 6    3    b
## 7    1    c
## 8    2    c
## 9    3    c
```

---
# Set conditions


```r
conditions &lt;- expand.grid(n = seq(5, 150, 5),
                          mu = seq(-2, 2, 0.25))
head(conditions)
```

```
##    n mu
## 1  5 -2
## 2 10 -2
## 3 15 -2
## 4 20 -2
## 5 25 -2
## 6 30 -2
```

```r
tail(conditions)
```

```
##       n mu
## 505 125  2
## 506 130  2
## 507 135  2
## 508 140  2
## 509 145  2
## 510 150  2
```

---
# Simulate!


```r
sim1 &lt;- map2(conditions$n, conditions$mu, ~rnorm(.x, .y, sd = 10))
str(sim1)
```

```
## List of 510
##  $ : num [1:5] 1.47 4.21 -3.88 -1.42 -1.68
##  $ : num [1:10] 7.75 -8.09 7.61 -1.84 -18.61 ...
##  $ : num [1:15] -3.84 -2.19 9.58 -0.82 -4.13 ...
##  $ : num [1:20] -7.421 3.697 -12.473 0.626 -5.097 ...
##  $ : num [1:25] 12.75 -13.56 -3.93 -10.55 -10.48 ...
##  $ : num [1:30] 12.63 -6.45 1.68 -2.72 -15.73 ...
##  $ : num [1:35] 6.8 -35.46 4.9 5.21 -18.6 ...
##  $ : num [1:40] -20.1641 -6.6494 3.8459 -0.0782 15.5604 ...
##  $ : num [1:45] -0.139 -2.251 11.996 -15.19 -7.86 ...
##  $ : num [1:50] 18.022 1.338 0.904 2.29 -5.007 ...
##  $ : num [1:55] -8.61 -4.21 6.22 4.39 -9.99 ...
##  $ : num [1:60] 9 -11.01 2.2 -5.56 -3.4 ...
##  $ : num [1:65] -4.508 -2.29 -6.871 -0.758 -13.045 ...
##  $ : num [1:70] 17.33 -9.2 -14.61 -12.83 6.87 ...
##  $ : num [1:75] 8.72 -6.16 -4.67 2.92 -16 ...
##  $ : num [1:80] -11.702 18.432 3.928 -13.13 0.929 ...
##  $ : num [1:85] -13.439 -5.278 -0.867 -8.354 14.282 ...
##  $ : num [1:90] 0.772 1.154 -19.369 8.707 1.572 ...
##  $ : num [1:95] -3.095 0.157 -25.479 -3.716 13.151 ...
##  $ : num [1:100] 2.3331 0.0165 -8.1208 -4.2457 5.284 ...
##  $ : num [1:105] 5.61 -1.05 -8.75 12.16 -1.78 ...
##  $ : num [1:110] 19.89 -6.36 -14 14.59 7.1 ...
##  $ : num [1:115] 5.261 9.895 5.485 -0.306 4.283 ...
##  $ : num [1:120] 9.82 4.81 1.48 23.24 2.44 ...
##  $ : num [1:125] -8.048 -1.401 -18.605 -1.533 -0.429 ...
##  $ : num [1:130] 0.254 -16.773 23.823 2.969 8.458 ...
##  $ : num [1:135] -15.91 3.2 -6.37 2.78 -1.38 ...
##  $ : num [1:140] -23.2 -10.3 -25 17 -22.2 ...
##  $ : num [1:145] -13.048 -6.708 -11.814 4.101 -0.753 ...
##  $ : num [1:150] 0.596 1.664 -10.232 -11.068 -19.47 ...
##  $ : num [1:5] -8.05 -12.59 -12.88 -8.23 3.75
##  $ : num [1:10] -7.33 -3.02 -3.21 -11.61 5.77 ...
##  $ : num [1:15] 6.53 -5.53 16.81 6.65 -28.41 ...
##  $ : num [1:20] 19.35 23.5 0.67 -13.76 1 ...
##  $ : num [1:25] -16.12 -15.08 -1.46 -3.04 -5.84 ...
##  $ : num [1:30] -8.28 -22.46 -3.59 -4.07 -2.59 ...
##  $ : num [1:35] -10.344 -2.718 -0.284 9.319 -2.446 ...
##  $ : num [1:40] 10.98 0.84 19.2 16.39 -9.91 ...
##  $ : num [1:45] -1.4827 -0.0713 -12.7236 -5.9948 -5.4728 ...
##  $ : num [1:50] -11.422 14.152 0.866 -5.052 8.335 ...
##  $ : num [1:55] 19.598 3.036 0.169 -4.97 4.308 ...
##  $ : num [1:60] -11.97 5.44 10.68 -13.59 2.86 ...
##  $ : num [1:65] -15.66 10.39 23 -8.95 -15.15 ...
##  $ : num [1:70] 1.47 4.83 2.04 3.13 5.8 ...
##  $ : num [1:75] 0.33 4.279 -20.332 14.218 0.493 ...
##  $ : num [1:80] 12.72 1.1 8.2 5.38 7.34 ...
##  $ : num [1:85] 3.38 9.37 5.55 2.86 -2.95 ...
##  $ : num [1:90] -4.643 5.46 -0.985 -9.447 -4.807 ...
##  $ : num [1:95] 3.292 -3.49 -11.29 12.886 -0.411 ...
##  $ : num [1:100] -4.825 13.497 -3.203 -0.418 -1.322 ...
##  $ : num [1:105] -1.74 -2.28 -1.4 -1.56 -6.72 ...
##  $ : num [1:110] 4.23 2.86 9.59 9.95 -12.28 ...
##  $ : num [1:115] 3.17 -3.8 1.64 -1.49 10.16 ...
##  $ : num [1:120] 11.99 1.13 5.23 9.06 10.6 ...
##  $ : num [1:125] -14.19 -1.44 -5.51 -10.85 -15.54 ...
##  $ : num [1:130] -11.88 4.99 -11.79 1.54 -6.21 ...
##  $ : num [1:135] -14.99 9.82 -19.74 -33.24 -7.7 ...
##  $ : num [1:140] -8.24 13.05 2.99 -9.95 -2.59 ...
##  $ : num [1:145] 9.27 -8.62 21.51 8.45 -1.07 ...
##  $ : num [1:150] -0.438 19.059 6.59 -1.834 -3.357 ...
##  $ : num [1:5] -1.584 2.24 0.938 -2.12 -8.993
##  $ : num [1:10] -16.64 -4.09 -8.25 -20.28 10.71 ...
##  $ : num [1:15] 1.15 8.53 -10.16 -4.6 10.11 ...
##  $ : num [1:20] 1.84 11.23 -1.99 -1.96 3.13 ...
##  $ : num [1:25] 8.12 6.75 2.03 -1.31 5.39 ...
##  $ : num [1:30] 13.72 7.22 -18.07 -9.25 -7.34 ...
##  $ : num [1:35] -13.28 -11.68 1.2 -7.65 -10.06 ...
##  $ : num [1:40] 13.78 3.83 -3.57 -13.81 -22.33 ...
##  $ : num [1:45] 15.89 14.39 -2.34 -3.53 3.2 ...
##  $ : num [1:50] -4.154 -18.812 -0.259 -3.778 16.28 ...
##  $ : num [1:55] 5.57 -5.62 -6.49 10.52 1.42 ...
##  $ : num [1:60] 8.13 -2.43 -10.84 7.44 -4.11 ...
##  $ : num [1:65] 1.058 -5.185 0.545 -2.264 -14.891 ...
##  $ : num [1:70] 1.81 -2.07 -1.41 3.9 -5.01 ...
##  $ : num [1:75] -10.816 6.885 7.032 -0.581 -8.957 ...
##  $ : num [1:80] 10.98 -2.73 -23.45 1.33 -14.7 ...
##  $ : num [1:85] -8.73 -11.69 5.71 5.62 -6.38 ...
##  $ : num [1:90] -14.46 9.99 -14.34 7.92 -23.04 ...
##  $ : num [1:95] -6.1866 -12.5724 5.4383 -6.5163 0.0747 ...
##  $ : num [1:100] 16.56 -7.15 -3.14 -4.74 -13.38 ...
##  $ : num [1:105] 0.587 -2.317 5.582 -5.009 9.5 ...
##  $ : num [1:110] 5.39 16.38 -1.95 -11.78 17.21 ...
##  $ : num [1:115] -8.881 -8.829 4.404 0.996 5.244 ...
##  $ : num [1:120] -3.33 -14.98 -10.13 4.51 1.89 ...
##  $ : num [1:125] -1.24 -9.96 -1.43 13.93 24.72 ...
##  $ : num [1:130] 5.842 2.668 0.365 0.165 -24.952 ...
##  $ : num [1:135] 9.26 -11.44 -10.03 -1.14 -15.45 ...
##  $ : num [1:140] -20.01 -4.42 15.03 -6.91 2.92 ...
##  $ : num [1:145] -14.37 2.79 2.98 12.5 -3.86 ...
##  $ : num [1:150] -8.28 4.19 -2.75 6.6 -9.03 ...
##  $ : num [1:5] 1.2 -8.13 -3.09 4.13 1.18
##  $ : num [1:10] 3.299 28.682 -20.746 -3.796 0.149 ...
##  $ : num [1:15] -5.12 -20.32 1.91 4.53 8.18 ...
##  $ : num [1:20] -3.52 -14.7 2.65 6.16 -15.37 ...
##  $ : num [1:25] -26.66 -15.45 8.07 5.14 -5.64 ...
##  $ : num [1:30] -4.58 -20.63 -12.69 -14.95 -3.39 ...
##  $ : num [1:35] 2.008 -0.481 -12.077 0.229 9.173 ...
##  $ : num [1:40] -1.12 1.16 -17.34 -10.81 -5.23 ...
##  $ : num [1:45] -2.58 -7.19 3.47 9.69 5.06 ...
##   [list output truncated]
```

---
# More powerful
### Add it as a list column!


```r
sim2 &lt;- conditions %&gt;%
	as_tibble() %&gt;% # Not required, but definitely helpful
	mutate(sim = map2(n, mu, ~rnorm(.x, .y, sd = 10))) 
sim2
```

```
## # A tibble: 510 x 3
##        n    mu sim       
##    &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    
##  1     5    -2 &lt;dbl [5]&gt; 
##  2    10    -2 &lt;dbl [10]&gt;
##  3    15    -2 &lt;dbl [15]&gt;
##  4    20    -2 &lt;dbl [20]&gt;
##  5    25    -2 &lt;dbl [25]&gt;
##  6    30    -2 &lt;dbl [30]&gt;
##  7    35    -2 &lt;dbl [35]&gt;
##  8    40    -2 &lt;dbl [40]&gt;
##  9    45    -2 &lt;dbl [45]&gt;
## 10    50    -2 &lt;dbl [50]&gt;
## # … with 500 more rows
```

---
# Unnest


```r
conditions %&gt;%
	as_tibble() %&gt;% # Not required, but definitely helpful
	mutate(sim = map2(n, mu, ~rnorm(.x, .y, sd = 10))) %&gt;%
	unnest()
```

```
## # A tibble: 39,525 x 3
##        n    mu        sim
##    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     5    -2  -6.799818
##  2     5    -2 -11.82891 
##  3     5    -2  -1.997035
##  4     5    -2  -5.874381
##  5     5    -2  -7.569429
##  6    10    -2 -16.78940 
##  7    10    -2 -14.90955 
##  8    10    -2 -13.69314 
##  9    10    -2  -1.759368
## 10    10    -2  -9.681130
## # … with 39,515 more rows
```

---
class: inverse center middle
# What if we wanted to vary the sd too?

--
### `pmap`
Which we'll get to soon

---
# Varying the title of a plot
### The data

```r
library(fivethirtyeight)
pulitzer
```

```
## # A tibble: 50 x 7
##    newspaper circ2004 circ2013 pctchg_circ num_finals1990_2003
##    &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;               &lt;int&gt;
##  1 USA Today  2192098  1674306         -24                   1
##  2 Wall Str…  2101017  2378827          13                  30
##  3 New York…  1119027  1865318          67                  55
##  4 Los Ange…   983727   653868         -34                  44
##  5 Washingt…   760034   474767         -38                  52
##  6 New York…   712671   516165         -28                   4
##  7 New York…   642844   500521         -22                   0
##  8 Chicago …   603315   414930         -31                  23
##  9 San Jose…   558874   583998           4                   4
## 10 Newsday     553117   377744         -32                  12
## # … with 40 more rows, and 2 more variables: num_finals2004_2014 &lt;int&gt;,
## #   num_finals1990_2014 &lt;int&gt;
```

---
# Prep data


```r
pulitzer &lt;- pulitzer %&gt;%
	select(newspaper, starts_with("num")) %&gt;%
	gather(year_range, n, -newspaper) %&gt;%
	mutate(year_range = str_replace_all(year_range, "num_finals", ""),
	       year_range = str_replace_all(year_range, "_", "-")) %&gt;%
	filter(year_range != "1990-2014")
pulitzer
```

```
## # A tibble: 100 x 3
##    newspaper             year_range     n
##    &lt;chr&gt;                 &lt;chr&gt;      &lt;int&gt;
##  1 USA Today             1990-2003      1
##  2 Wall Street Journal   1990-2003     30
##  3 New York Times        1990-2003     55
##  4 Los Angeles Times     1990-2003     44
##  5 Washington Post       1990-2003     52
##  6 New York Daily News   1990-2003      4
##  7 New York Post         1990-2003      0
##  8 Chicago Tribune       1990-2003     23
##  9 San Jose Mercury News 1990-2003      4
## 10 Newsday               1990-2003     12
## # … with 90 more rows
```

---
# One plot


```r
pulitzer %&gt;%
	filter(newspaper == "Wall Street Journal") %&gt;%
ggplot(aes(year_range, n)) +
	geom_col(aes(fill = n)) +
	scale_fill_distiller(type = "seq", 
	                     limits = c(0, max(pulitzer$n)),
	                     palette = "BuPu",
	                     direction = 1) +
	ylim(0, max(pulitzer$n)) +
	coord_flip() +
	labs(title = "Pulitzer Prize winners: Wall Street Journal",
	     x = "Year Range") 
```

![](w5p1_files/figure-html/one-plot-pulitzer-1.png)&lt;!-- --&gt;


---
# Nest data


```r
pulitzer %&gt;%
	group_by(newspaper) %&gt;%
	nest()
```

```
## # A tibble: 50 x 2
##    newspaper             data            
##    &lt;chr&gt;                 &lt;list&gt;          
##  1 USA Today             &lt;tibble [2 × 2]&gt;
##  2 Wall Street Journal   &lt;tibble [2 × 2]&gt;
##  3 New York Times        &lt;tibble [2 × 2]&gt;
##  4 Los Angeles Times     &lt;tibble [2 × 2]&gt;
##  5 Washington Post       &lt;tibble [2 × 2]&gt;
##  6 New York Daily News   &lt;tibble [2 × 2]&gt;
##  7 New York Post         &lt;tibble [2 × 2]&gt;
##  8 Chicago Tribune       &lt;tibble [2 × 2]&gt;
##  9 San Jose Mercury News &lt;tibble [2 × 2]&gt;
## 10 Newsday               &lt;tibble [2 × 2]&gt;
## # … with 40 more rows
```


---
# Produce all plots
### You try first!
Don't worry about the correct title yet, if you don't want

--

```r
pulitzer %&gt;%
	group_by(newspaper) %&gt;%
	nest() %&gt;%
	mutate(plot = map(data, ~ggplot(.x, aes(year_range, n)) +
		geom_col(aes(fill = n)) +
		scale_fill_distiller(type = "seq", 
		                     limits = c(0, max(pulitzer$n)),
		                     palette = "BuPu",
		                     direction = 1) +
	  ylim(0, max(pulitzer$n)) +
	  coord_flip() +
		labs(title = "Pulitzer Prize winners")))
```

```
## # A tibble: 50 x 3
##    newspaper             data             plot    
##    &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;  
##  1 USA Today             &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  2 Wall Street Journal   &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  3 New York Times        &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  4 Los Angeles Times     &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  5 Washington Post       &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  6 New York Daily News   &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  7 New York Post         &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  8 Chicago Tribune       &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  9 San Jose Mercury News &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
## 10 Newsday               &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
## # … with 40 more rows
```


---
# Add title


```r
library(glue)

p &lt;- pulitzer %&gt;%
	group_by(newspaper) %&gt;%
	nest() %&gt;%
	mutate(plot = map2(data, newspaper, ~
	  ggplot(.x, aes(year_range, n)) +
		  geom_col(aes(fill = n)) +
		  scale_fill_distiller(type = "seq", 
		                       limits = c(0, max(pulitzer$n)),
		                       palette = "BuPu",
		                       direction = 1) +
	    ylim(0, max(pulitzer$n)) +
	    coord_flip() +
		  labs(title = glue("Pulitzer Prize winners: {.y}"))))
```

--- 

```r
p
```

```
## # A tibble: 50 x 3
##    newspaper             data             plot    
##    &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;  
##  1 USA Today             &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  2 Wall Street Journal   &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  3 New York Times        &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  4 Los Angeles Times     &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  5 Washington Post       &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  6 New York Daily News   &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  7 New York Post         &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  8 Chicago Tribune       &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
##  9 San Jose Mercury News &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
## 10 Newsday               &lt;tibble [2 × 2]&gt; &lt;S3: gg&gt;
## # … with 40 more rows
```

---
# Look at a couple plots

.pull-left[

```r
p$plot[[1]]
```

![](w5p1_files/figure-html/p1-1.png)&lt;!-- --&gt;

```r
p$plot[[3]]
```

![](w5p1_files/figure-html/p1-2.png)&lt;!-- --&gt;
]

.pull-right[

```r
p$plot[[2]]
```

![](w5p1_files/figure-html/p2-1.png)&lt;!-- --&gt;

```r
p$plot[[4]]
```

![](w5p1_files/figure-html/p2-2.png)&lt;!-- --&gt;
]

---
class: inverse center middle
# iterating over `\(n\)` vectors
### `pmap`


---
class: inverse
background-image:url(https://d33wubrfki0l68.cloudfront.net/e426c5755e2e65bdcc073d387775db79791f32fd/92902/diagrams/functionals/pmap.png)
background-size:contain
## `pmap`


---
# Simulation
* Simulate data from a normal distribution
	+ Vary `\(n\)` from 5 to 150 by increments of 5
	+ For each `\(n\)`, vary `\(mu\)` from -2 to 2 by increments of 0.25
	+ For each `\(\sigma\)` from 1 to 3 by increments of 0.1


---

```r
full_conditions &lt;- expand.grid(n = seq(5, 150, 5),
                               mu = seq(-2, 2, 0.25),
                               sd = seq(1, 3, .1))
head(full_conditions)
```

```
##    n mu sd
## 1  5 -2  1
## 2 10 -2  1
## 3 15 -2  1
## 4 20 -2  1
## 5 25 -2  1
## 6 30 -2  1
```

```r
tail(full_conditions)
```

```
##         n mu sd
## 10705 125  2  3
## 10706 130  2  3
## 10707 135  2  3
## 10708 140  2  3
## 10709 145  2  3
## 10710 150  2  3
```

---
# Full Simulation


```r
fsim &lt;- pmap(list(number = full_conditions$n,
                  average = full_conditions$mu,
                  stdev = full_conditions$sd), 
             function(number, average, stdev) {
             	rnorm(n = number, mean = average, sd = stdev)
             })
str(fsim)
```

```
## List of 10710
##  $ : num [1:5] -0.68509 -0.00408 -2.12953 -3.06301 -1.7573
##  $ : num [1:10] -1.043 -2.461 -2.128 -0.523 -2 ...
##  $ : num [1:15] -2.82 -1.555 -1.828 -0.666 -2.829 ...
##  $ : num [1:20] -4.17 -1.3 -2.86 -1.99 -4.05 ...
##  $ : num [1:25] -1.8358 0.0138 -2.1699 -3.817 -2.1927 ...
##  $ : num [1:30] -1.739 -0.773 -2.072 -0.425 -1.092 ...
##  $ : num [1:35] -2.42 -3.08 -2.65 -2.21 -1.99 ...
##  $ : num [1:40] -1.551 -1.527 0.317 -0.25 -1.227 ...
##  $ : num [1:45] -2.44 -1.29 -1.56 -2.49 -3.1 ...
##  $ : num [1:50] -1.78 -2.26 -2.56 -3.54 -1.67 ...
##  $ : num [1:55] -1.937 -1.24 -0.9 -0.597 -2.127 ...
##  $ : num [1:60] -2.79 -2.3 -1.01 -2.44 -2.44 ...
##  $ : num [1:65] -2.8 -1.74 -2.33 -1.52 -1.08 ...
##  $ : num [1:70] -2.1 -3.04 -2.81 -2.45 -1.15 ...
##  $ : num [1:75] -1.717 -2.612 0.117 -1.497 -2.025 ...
##  $ : num [1:80] -2.202 -0.528 -1.808 -2.355 -1.484 ...
##  $ : num [1:85] -3.166 -0.353 -0.961 -3.237 -0.196 ...
##  $ : num [1:90] -1.518 -2.716 -4.033 -0.682 -4.543 ...
##  $ : num [1:95] -3.418 -1.288 -0.354 -1.467 -0.705 ...
##  $ : num [1:100] -0.613 -0.902 -2.497 -2.58 -1.605 ...
##  $ : num [1:105] -1.505563 -0.000293 -3.454015 -1.913535 -1.611799 ...
##  $ : num [1:110] -2.08 -2.06 -1.08 -1.31 -2.15 ...
##  $ : num [1:115] -2.437 -0.777 -1.031 -0.445 -2.479 ...
##  $ : num [1:120] -2.503 -0.418 -2.299 -3.052 -1.351 ...
##  $ : num [1:125] -1.454 -0.928 -2.009 -2.103 -2.121 ...
##  $ : num [1:130] -1.743 -0.666 -2.409 -0.503 -2.756 ...
##  $ : num [1:135] -1.72 -3.6 -1.58 -2.68 -1.36 ...
##  $ : num [1:140] -1.493 0.24 -3.447 -1.716 -0.423 ...
##  $ : num [1:145] -1.91 -1.25 -2.55 -0.33 -2.88 ...
##  $ : num [1:150] -0.574 -3.851 -2.222 -2.089 -1.798 ...
##  $ : num [1:5] -2.342 -1.74 1.243 -0.822 -1.402
##  $ : num [1:10] -1.89 -2.4 -2.23 -2.78 -1.25 ...
##  $ : num [1:15] -2.62 -1.66 -2.56 -2.41 -2.48 ...
##  $ : num [1:20] -0.22 -1.362 -0.446 -0.712 -0.354 ...
##  $ : num [1:25] -4.37 -1.59 -1.81 -1.14 -1.66 ...
##  $ : num [1:30] -0.773 -1.058 -0.405 -3.479 -3.415 ...
##  $ : num [1:35] -0.504 -2.04 -3.081 -3.589 -0.298 ...
##  $ : num [1:40] -0.539 -0.955 -2.965 -1.544 -3.243 ...
##  $ : num [1:45] -1.5 -3.94 -3.54 -3.24 -4.77 ...
##  $ : num [1:50] -1.46 -1.52 -1.26 -1.45 -2.54 ...
##  $ : num [1:55] -0.632 -2.788 -1.001 -0.585 -2.037 ...
##  $ : num [1:60] -2.63 -3.6 -1.39 -1.05 -2.03 ...
##  $ : num [1:65] -0.617 -1.515 -0.299 -2.035 -2.359 ...
##  $ : num [1:70] -1.782 0.468 -0.833 -0.894 -2.572 ...
##  $ : num [1:75] -4.25 -1.57 -2.26 -1.88 -2.66 ...
##  $ : num [1:80] -1.8 -2.85 -3.05 -1.61 -1.21 ...
##  $ : num [1:85] -2.508 -4.129 -0.687 -0.482 -2.381 ...
##  $ : num [1:90] -0.923 -3.151 -1.758 -0.708 -0.865 ...
##  $ : num [1:95] -1.278 -0.929 -3.696 -1.814 -1.805 ...
##  $ : num [1:100] -1.584 -0.641 -0.975 -2.935 -0.914 ...
##  $ : num [1:105] -2.1381 -1.8323 -3.8069 -1.7061 0.0623 ...
##  $ : num [1:110] -1.858 -1.131 -1.707 -0.454 -0.875 ...
##  $ : num [1:115] -1.48 -1.76 -1.5 -2.51 -3.62 ...
##  $ : num [1:120] -0.688 -0.96 -0.824 -1.392 -2.546 ...
##  $ : num [1:125] -2.149 -1.732 -0.864 -0.376 -1.74 ...
##  $ : num [1:130] -2.868 0.293 -2.335 -1.417 -2.37 ...
##  $ : num [1:135] 0.0483 -2.0989 -2.8763 -2.7865 -0.4937 ...
##  $ : num [1:140] -1.969 -2.177 -1.749 -0.391 -1.446 ...
##  $ : num [1:145] -2.301 -2.059 -0.352 -2.734 -2.284 ...
##  $ : num [1:150] -0.622 -0.159 -1.013 -2.577 -1.303 ...
##  $ : num [1:5] -0.551 -2.239 -1.642 -2.084 0.533
##  $ : num [1:10] -1.552 -2.007 -3.492 0.57 -0.486 ...
##  $ : num [1:15] -0.164 -1.884 -3.539 -0.941 -2.377 ...
##  $ : num [1:20] -0.222 -1.966 -0.576 -2.639 -1.518 ...
##  $ : num [1:25] -1.733 -4.274 0.658 -2.054 -1.02 ...
##  $ : num [1:30] -1.967 -2.224 -1.936 -0.732 -2.365 ...
##  $ : num [1:35] -1.494 -0.261 -1.51 -1.029 -2.423 ...
##  $ : num [1:40] -0.766 -1.707 -3.646 -3.002 -0.879 ...
##  $ : num [1:45] -0.986 -1.675 -2.725 -0.678 -1.422 ...
##  $ : num [1:50] -3.047 -1.246 -1.942 -0.568 -0.519 ...
##  $ : num [1:55] -1.449 -1.781 0.212 -2.399 -2.089 ...
##  $ : num [1:60] -0.177 -1.709 -0.251 -1.535 -0.17 ...
##  $ : num [1:65] 0.472 -1.8555 0.0957 -2.0357 -0.1625 ...
##  $ : num [1:70] -0.413 -0.607 -2.451 -1.79 -1.103 ...
##  $ : num [1:75] -0.638 -2.205 -1.816 -0.905 -2.558 ...
##  $ : num [1:80] -1.681 -0.115 -0.809 -0.914 -2.714 ...
##  $ : num [1:85] -1.25 -2.45 -2.6 -2 -1.77 ...
##  $ : num [1:90] -1.9309 -1.4778 -1.5617 -1.2644 -0.0844 ...
##  $ : num [1:95] -0.909 -0.994 -2.281 -0.599 -1.436 ...
##  $ : num [1:100] -0.392 -0.983 0.479 1.216 -2.12 ...
##  $ : num [1:105] -0.262 -1.139 -1.893 1.498 -1.443 ...
##  $ : num [1:110] -0.725 -1.174 -1.997 -0.678 -0.948 ...
##  $ : num [1:115] 0.111 -2.35 -0.68 -0.733 -0.891 ...
##  $ : num [1:120] -1.3 -1.88 -2.27 -2.29 -2.73 ...
##  $ : num [1:125] -1.9 -1.17 -3.14 -2.43 -2.01 ...
##  $ : num [1:130] -2.681 -1.377 -0.333 -1.028 -1.592 ...
##  $ : num [1:135] -2.3874 -1.9718 0.0821 -1.4548 -1.4945 ...
##  $ : num [1:140] -3.055 -1.493 -2.036 -0.564 -3.656 ...
##  $ : num [1:145] -0.831 -3.321 -1.066 -2.621 -2.986 ...
##  $ : num [1:150] -1.401 0.341 -2.264 -1.541 -1.626 ...
##  $ : num [1:5] -0.534 -0.964 -0.24 -1.706 -3.671
##  $ : num [1:10] -2.7 1.45 -2.88 -2.25 -1.55 ...
##  $ : num [1:15] -1.3734 -0.76 -0.0155 -0.4264 -2.078 ...
##  $ : num [1:20] 0.419 -2.322 -1.464 -2.997 -2.793 ...
##  $ : num [1:25] -2.597 -0.485 -1.307 -0.581 -0.86 ...
##  $ : num [1:30] 1.056 -2.542 -1.374 -0.492 -2.512 ...
##  $ : num [1:35] -0.623 -2.034 -0.314 -3.22 1.112 ...
##  $ : num [1:40] -0.3905 -1.9224 0.0561 -2.486 -2.4026 ...
##  $ : num [1:45] -0.979 -0.342 -1.159 -1.111 -0.312 ...
##   [list output truncated]
```

---
# Alternative spec


```r
fsim &lt;- pmap(list(full_conditions$n,
                  full_conditions$mu,
                  full_conditions$sd),
            ~rnorm(n = ..1, mean = ..2, sd = ..3))
str(fsim)
```

```
## List of 10710
##  $ : num [1:5] -1.732 -4.046 -0.882 -1.318 0.102
##  $ : num [1:10] -2.59 -2.39 -1.57 -1.56 -3.3 ...
##  $ : num [1:15] -0.849 -1.381 -1.831 -1.879 -1.121 ...
##  $ : num [1:20] -2.345 -0.497 -0.884 -1.316 -3.192 ...
##  $ : num [1:25] -0.3437 -1.6887 -2.7514 0.0419 -1.5099 ...
##  $ : num [1:30] -2.043 -0.678 -0.745 -1.69 -1.088 ...
##  $ : num [1:35] -2.65 -1.48 -1.65 -2.84 -2.23 ...
##  $ : num [1:40] -2.85 -2.425 -1.35 -0.432 -3.335 ...
##  $ : num [1:45] -2.91 -3.59 -2.7 -1.84 -1.56 ...
##  $ : num [1:50] -2.557 -2.953 -0.053 -1.976 -1.742 ...
##  $ : num [1:55] -2.66 -1.94 -0.917 -2.746 -1.57 ...
##  $ : num [1:60] -1.05 -2.824 -2.057 -0.907 -2.253 ...
##  $ : num [1:65] -2.7 -2.18 -1.11 -1.32 -1.28 ...
##  $ : num [1:70] -3.48 -3.93 -1.51 -2.56 -1.46 ...
##  $ : num [1:75] -1.277 0.255 -1.15 -2.819 -1.231 ...
##  $ : num [1:80] -2.243 -2.165 -0.542 -2.482 -1.958 ...
##  $ : num [1:85] -1.601 -0.107 -0.9 -0.619 -2.8 ...
##  $ : num [1:90] -2.345 -0.818 -3.436 -2.718 -0.925 ...
##  $ : num [1:95] -1.85 -2.08 -1.92 -2.85 -2.01 ...
##  $ : num [1:100] -1.03 -1.27 -1.39 -4.03 -4.6 ...
##  $ : num [1:105] -1.52 -2.96 -2.37 -1.76 -2.4 ...
##  $ : num [1:110] -2.442 -0.318 -1.11 -1.514 -3.479 ...
##  $ : num [1:115] -1.43 -2.7 -3.27 -3.13 -2.85 ...
##  $ : num [1:120] -1.25 -2.15 -2.36 -2.12 -1.25 ...
##  $ : num [1:125] -1.6126 0.0636 -2.2597 0.1036 -1.5659 ...
##  $ : num [1:130] -1.632 -1.489 -3.907 -1.518 -0.683 ...
##  $ : num [1:135] -4.58 -2.51 -1.18 -3.35 -1.74 ...
##  $ : num [1:140] -3.85 -2.9 -1.2 -2.07 -2.91 ...
##  $ : num [1:145] -3.27 -1.83 -1.66 -1.05 -3.53 ...
##  $ : num [1:150] -0.365 -5.258 -3.05 -2.327 -0.799 ...
##  $ : num [1:5] -1.3 -1.25 -2.14 -2.6 -2.5
##  $ : num [1:10] -1.59658 -0.91354 -1.3489 -0.17555 0.00847 ...
##  $ : num [1:15] -2.015 -1.694 -0.804 -1.276 -1.185 ...
##  $ : num [1:20] -3.08 -2.21 0.2 -2.42 -2.16 ...
##  $ : num [1:25] -2.43 -3.26 -2.08 -3.19 -2.34 ...
##  $ : num [1:30] -0.695 -0.904 -0.751 0.786 -2.302 ...
##  $ : num [1:35] -1.73615 0.00236 -2.1524 -3.18931 -1.03048 ...
##  $ : num [1:40] -1.499 -2.69 -1.968 -3.009 -0.236 ...
##  $ : num [1:45] -1.7 -1.76 -2.28 -1.9 -1.69 ...
##  $ : num [1:50] -1.4636 -0.6809 0.0559 -1.2022 -1.7239 ...
##  $ : num [1:55] -1.31 -2.355 -2.13 -0.896 -2.627 ...
##  $ : num [1:60] -2.51 -1.71 -1.89 -0.46 -3.31 ...
##  $ : num [1:65] -0.8358 -2.0906 0.0624 -2.6787 -0.5966 ...
##  $ : num [1:70] -1.224 -1.925 -0.568 -0.247 -0.984 ...
##  $ : num [1:75] -2.59 -1.5 -2.29 -3.09 -1.47 ...
##  $ : num [1:80] -0.495 -3.703 -0.579 -1.719 -1.123 ...
##  $ : num [1:85] -0.591 0.279 -2.77 -2.923 -4.027 ...
##  $ : num [1:90] -1.759 -1.7 -4.13 0.272 -1.432 ...
##  $ : num [1:95] -2.86 -1.1 -3.19 -1.74 -1.26 ...
##  $ : num [1:100] -1.85 -1.85 -1.29 -3.51 -2.38 ...
##  $ : num [1:105] -1.181 -2.431 -0.783 -2.118 -1.782 ...
##  $ : num [1:110] -1.637 -1.996 -3.192 -0.157 -0.684 ...
##  $ : num [1:115] -1.916 -2.221 -4.171 -1.464 -0.562 ...
##  $ : num [1:120] -1.6289 -2.3933 -1.7416 -1.581 0.0584 ...
##  $ : num [1:125] -1.009 -1.795 0.239 -4.157 -1.106 ...
##  $ : num [1:130] -1.653 -0.526 -2.789 -1.35 -1.889 ...
##  $ : num [1:135] -2.419 -1.625 -0.928 -1.558 -0.346 ...
##  $ : num [1:140] -1.44 -1.91 -2.58 -2.28 -2.54 ...
##  $ : num [1:145] -1.94 -3.42 -1.85 -1.77 -1.09 ...
##  $ : num [1:150] -1.45 -1.74 -2.58 -1.92 -2.26 ...
##  $ : num [1:5] -1.51 -2.65 -1.56 -1.91 -2.19
##  $ : num [1:10] -3.25 -2.89 -3.16 -1.71 -1.24 ...
##  $ : num [1:15] -0.916 -2.136 -0.584 -1.28 -1.769 ...
##  $ : num [1:20] -1.5 -1.13 -1.31 -2.65 -1.85 ...
##  $ : num [1:25] -2.144 -1.914 0.751 -1.419 -1.257 ...
##  $ : num [1:30] -2.73 -2.15 -3.68 -1.91 -2.72 ...
##  $ : num [1:35] -0.496 -0.584 -0.317 -1.727 -2.669 ...
##  $ : num [1:40] -1.724 -0.44 -1.781 -1.465 -0.546 ...
##  $ : num [1:45] 0.216 -1.33 -0.309 -1.629 -2.126 ...
##  $ : num [1:50] -2.64 -2.11 -2.88 -3.24 -1.55 ...
##  $ : num [1:55] -0.56505 -3.561 -2.25931 -0.00462 -3.01297 ...
##  $ : num [1:60] -1.739 -0.816 -2.023 -0.187 -1.754 ...
##  $ : num [1:65] -0.996 0.434 -0.289 -1.435 -0.488 ...
##  $ : num [1:70] -0.477 -0.925 -1.381 -2.585 -0.779 ...
##  $ : num [1:75] -1.09 -1.43 -3.43 -1.11 -1.63 ...
##  $ : num [1:80] -1.709 -1.616 0.172 -1.445 -1.159 ...
##  $ : num [1:85] -0.922 -0.493 -0.601 -2.283 -2.601 ...
##  $ : num [1:90] -2.82 -0.714 -0.371 -1.843 -2.364 ...
##  $ : num [1:95] -1.52 -2.85 -3.14 -1.34 -1.1 ...
##  $ : num [1:100] -2.351 -0.463 0.606 -3.216 -0.929 ...
##  $ : num [1:105] -2.193 -1.929 -0.166 -0.125 0.923 ...
##  $ : num [1:110] -1.552 -1.389 -0.936 -0.913 -2.238 ...
##  $ : num [1:115] -1.044 -1.026 -1.432 -0.901 -1.667 ...
##  $ : num [1:120] -3.766 -0.395 -1.648 -3.439 -2.581 ...
##  $ : num [1:125] -2.047 -1.479 -2.306 -0.96 -0.982 ...
##  $ : num [1:130] -2.665 -1.223 -0.669 -0.19 -2.078 ...
##  $ : num [1:135] 0.28 -0.261 -4.118 -0.493 -2.357 ...
##  $ : num [1:140] -2.142 -0.985 -1.308 -2.141 -0.752 ...
##  $ : num [1:145] -2.048 0.437 -3.619 1.816 -2.959 ...
##  $ : num [1:150] -1.792 -2.089 -2.073 -0.798 -3.431 ...
##  $ : num [1:5] -0.137 -2.105 -0.689 -0.753 -1.485
##  $ : num [1:10] -1.242 -1.422 0.598 -4.07 -0.551 ...
##  $ : num [1:15] -1.14 -1.33 -2.69 -3.54 -4.71 ...
##  $ : num [1:20] 0.90915 -0.00397 -2.61654 0.74897 -0.04806 ...
##  $ : num [1:25] -0.814 -1.339 -1.313 -3.076 -0.773 ...
##  $ : num [1:30] -2.84 -1.37 -1.05 -2.15 -1.25 ...
##  $ : num [1:35] -2.5616 0.0113 -2.2843 -1.8529 0.1168 ...
##  $ : num [1:40] -1.429 -0.902 -0.94 -2.377 0.801 ...
##  $ : num [1:45] -1.21 -2.02 -1.5 -1.51 -1.9 ...
##   [list output truncated]
```

---
# Simpler
### Maybe a little too clever
* A data frame is a list so...


```r
fsim &lt;- pmap(full_conditions, ~rnorm(n = ..1, 
                                     mean = ..2, 
                                     sd = ..3))
str(fsim)
```

```
## List of 10710
##  $ : num [1:5] -2.67 -1.71 -3.72 -1.05 -2.57
##  $ : num [1:10] -1.88 -1.52 -1.98 -1.13 -1.28 ...
##  $ : num [1:15] -2.022 -2.413 -0.846 -2.005 -0.864 ...
##  $ : num [1:20] -2.945 -3.135 -2.305 -2.507 -0.111 ...
##  $ : num [1:25] -2.114 -1.132 -3.318 -0.686 -2.381 ...
##  $ : num [1:30] -2.08 -3.18 -1.35 -1.13 -4.8 ...
##  $ : num [1:35] -2.13 -1.2 -2.34 -1.93 -2.08 ...
##  $ : num [1:40] -1.3611 -3.8349 -2.3402 -1.12 -0.0739 ...
##  $ : num [1:45] -1.547 -0.761 -2.548 -2.908 -0.806 ...
##  $ : num [1:50] -2.01 -1.32 -1.51 -1.96 -1.19 ...
##  $ : num [1:55] -3.077 -2.245 -2.603 -0.235 -1.557 ...
##  $ : num [1:60] -2.68 -1.55 -3.45 -2.22 -2.24 ...
##  $ : num [1:65] -3.09 -3.21 -3.11 -2.58 -1.64 ...
##  $ : num [1:70] -2.886 -0.975 -1.356 -1.311 -2.582 ...
##  $ : num [1:75] -1.957 -1.784 -3.355 -1.897 -0.569 ...
##  $ : num [1:80] -1.51 -1.44 -4.29 -2.81 -2.96 ...
##  $ : num [1:85] -1.232 -0.781 -0.565 -0.77 -1.722 ...
##  $ : num [1:90] -2.419 -0.346 -1.075 -2.098 -2.208 ...
##  $ : num [1:95] -2.1 -3.69 -0.93 -2.99 -2.62 ...
##  $ : num [1:100] -2.8457 -2.3429 -1.7472 -3.1527 -0.0304 ...
##  $ : num [1:105] -1.38 -3.04 -2.49 -2.77 -2.77 ...
##  $ : num [1:110] -1.98 -2.98 -1.93 -1.48 -2.9 ...
##  $ : num [1:115] -1.35 -3.27 -1.22 -1.13 -2.89 ...
##  $ : num [1:120] -0.882 -2.275 -1.025 -0.834 -2.586 ...
##  $ : num [1:125] -2.184 -0.205 -1.91 -2.356 -0.557 ...
##  $ : num [1:130] -1.416 -0.938 -0.767 -2.234 -2.567 ...
##  $ : num [1:135] -1.278 -2.025 -2.13 -3.897 -0.716 ...
##  $ : num [1:140] -1.423 -0.837 -2.003 -2.169 -1.566 ...
##  $ : num [1:145] -2.557 -2.92 -2.619 -0.994 -1.802 ...
##  $ : num [1:150] -1.815 -1.154 -1.615 -2.145 0.198 ...
##  $ : num [1:5] -3.899 0.605 -1.199 -3.132 -2.831
##  $ : num [1:10] -2.777 -0.843 -1.012 -0.161 -1.549 ...
##  $ : num [1:15] -1.286 -1.55 -0.409 -2.024 -2.829 ...
##  $ : num [1:20] -2.009 -0.982 -2.331 -2.535 -0.52 ...
##  $ : num [1:25] -0.44 -2.791 -0.517 -2.011 -0.745 ...
##  $ : num [1:30] -0.871 -1.33 -1.225 -0.601 -1.794 ...
##  $ : num [1:35] -0.044 -1.648 -0.94 -1.353 -2.909 ...
##  $ : num [1:40] -1.641 -0.381 -2.182 -3.803 -3.658 ...
##  $ : num [1:45] -0.948 -2.383 -0.665 -2.982 -1.603 ...
##  $ : num [1:50] -2.314 -1.509 -1.072 -1.799 -0.277 ...
##  $ : num [1:55] -3.667 -2.278 -0.323 -2.792 -0.869 ...
##  $ : num [1:60] -2.964 -1.686 -2.235 -1.776 -0.767 ...
##  $ : num [1:65] -1.79 -2.41 -2.99 -1.21 -1.19 ...
##  $ : num [1:70] -0.712 -3.377 -2.571 -2.432 -2.711 ...
##  $ : num [1:75] -0.893 -3.148 -1.45 -1.678 -1.179 ...
##  $ : num [1:80] -2.198 -0.985 -2.196 -0.565 -1.778 ...
##  $ : num [1:85] -2.275 -2.463 -1.589 -0.123 -1.6 ...
##  $ : num [1:90] -0.571 -2.013 -1.97 -2.583 -2.527 ...
##  $ : num [1:95] -1.9101 -2.3844 -3.2556 -1.6497 0.0366 ...
##  $ : num [1:100] -3.31 -3.4 -1.11 -1.47 -2.3 ...
##  $ : num [1:105] -1.55 -2.18 -1.55 -1.45 -2.41 ...
##  $ : num [1:110] -2.064 -3.176 -2.269 -1.598 -0.205 ...
##  $ : num [1:115] -1.995 -2.867 -0.653 -1.566 -3.066 ...
##  $ : num [1:120] -1.19 -2.29 -1.04 -3.23 -2.48 ...
##  $ : num [1:125] -2.249 -1.728 -0.624 -1.704 -2.372 ...
##  $ : num [1:130] -2.56 -1.45 -3.04 -2.38 -2.75 ...
##  $ : num [1:135] -1.61 -2.44 -2.69 -1.13 -0.68 ...
##  $ : num [1:140] -0.274 -1.334 -1.125 -0.78 -2.751 ...
##  $ : num [1:145] -1.14 -1.87 -1.48 -1.53 -1.44 ...
##  $ : num [1:150] -0.969 -0.415 -1.031 -3.312 -1.469 ...
##  $ : num [1:5] -1.988 -1.923 -1.179 -0.654 -1.945
##  $ : num [1:10] -1.446 -0.812 -2.814 -0.755 -1.201 ...
##  $ : num [1:15] -2.02 -2.62 -2.99 -1.67 -1.89 ...
##  $ : num [1:20] -2.87 -2.37 -1.49 -1.56 -1.28 ...
##  $ : num [1:25] -0.937 -3.304 -1.498 -1.007 -0.502 ...
##  $ : num [1:30] -1.649 -1.95 -0.547 -0.39 -2.588 ...
##  $ : num [1:35] -0.745 -1.59 -0.756 -2.075 -1.439 ...
##  $ : num [1:40] -1.739 -0.98 -2.483 -1.082 0.183 ...
##  $ : num [1:45] -2.11 -1.481 -0.203 -0.298 -0.534 ...
##  $ : num [1:50] -0.937 -2.891 -2.06 -2.574 -2.364 ...
##  $ : num [1:55] -1.31 -2.24 -2.57 -1.33 -2.17 ...
##  $ : num [1:60] -1.16 -1.67 -3.4 -1.27 -2.59 ...
##  $ : num [1:65] -1.04 -1.97 -1.85 -1.78 -3.94 ...
##  $ : num [1:70] -1.074 0.404 -0.75 -2.763 -1.417 ...
##  $ : num [1:75] -2.28 -2.58 -1.57 -1.97 -1.31 ...
##  $ : num [1:80] -2.45 -2.31 -1.36 -2.34 -3.38 ...
##  $ : num [1:85] -1.019 0.148 -0.145 -0.79 -2.006 ...
##  $ : num [1:90] -2.646 -0.796 -0.308 -1.336 -0.281 ...
##  $ : num [1:95] -0.7775 -3.172 -0.4688 0.0982 -2.136 ...
##  $ : num [1:100] -0.746 -1.306 -1.922 0.472 0.115 ...
##  $ : num [1:105] -0.283 -1.122 -1.297 -0.708 -2.745 ...
##  $ : num [1:110] -2.93 -2.17 -2.37 -1.08 -1.23 ...
##  $ : num [1:115] -1.84 -2.275 -2.054 -0.856 -2.919 ...
##  $ : num [1:120] -3.32 -1.31 -1.7 -1.75 -2.34 ...
##  $ : num [1:125] -1.31 -2.51 -2.37 -3.51 -1.6 ...
##  $ : num [1:130] -1.859 -2.098 -2.144 -1.859 -0.304 ...
##  $ : num [1:135] -1.361 -1.265 -1.466 -2.727 -0.481 ...
##  $ : num [1:140] -0.432 -1.259 -2.275 -0.48 -0.699 ...
##  $ : num [1:145] -0.41 -0.473 -1.52 -2.569 -2.015 ...
##  $ : num [1:150] -0.48 -1.91 -0.47 -1.4 -1.19 ...
##  $ : num [1:5] 0.533 -0.356 -1.329 -2.72 -1.691
##  $ : num [1:10] -0.313 -2.251 -1.008 -1.901 -0.875 ...
##  $ : num [1:15] -1.63 -0.842 -1.39 -2.292 -0.763 ...
##  $ : num [1:20] -1.962 -1.112 -2.258 -0.62 -0.439 ...
##  $ : num [1:25] -1.07 -2.08 -1.71 -1.35 -1.76 ...
##  $ : num [1:30] -0.852 -0.744 -1.38 -0.881 -2.015 ...
##  $ : num [1:35] -0.107 -2.893 -1.638 -0.333 -2.864 ...
##  $ : num [1:40] -0.217 -1.377 -1.526 -1.719 -2.46 ...
##  $ : num [1:45] -2.307 -1.697 -0.945 -3.341 -1.044 ...
##   [list output truncated]
```
---
# List column version


```r
full_conditions %&gt;%
	as_tibble() %&gt;%
	mutate(sim = pmap(list(n, mu, sd), ~rnorm(..1, ..2, ..3)))
```

```
## # A tibble: 10,710 x 4
##        n    mu    sd sim       
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    
##  1     5    -2     1 &lt;dbl [5]&gt; 
##  2    10    -2     1 &lt;dbl [10]&gt;
##  3    15    -2     1 &lt;dbl [15]&gt;
##  4    20    -2     1 &lt;dbl [20]&gt;
##  5    25    -2     1 &lt;dbl [25]&gt;
##  6    30    -2     1 &lt;dbl [30]&gt;
##  7    35    -2     1 &lt;dbl [35]&gt;
##  8    40    -2     1 &lt;dbl [40]&gt;
##  9    45    -2     1 &lt;dbl [45]&gt;
## 10    50    -2     1 &lt;dbl [50]&gt;
## # … with 10,700 more rows
```
---
# Unnest

```r
full_conditions %&gt;%
	as_tibble() %&gt;%
	mutate(sim = pmap(list(n, mu, sd), ~rnorm(..1, ..2, ..3))) %&gt;%
	unnest()
```

```
## # A tibble: 830,025 x 4
##        n    mu    sd        sim
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     5    -2     1 -1.152654 
##  2     5    -2     1 -2.468304 
##  3     5    -2     1 -0.5156141
##  4     5    -2     1 -1.163307 
##  5     5    -2     1 -2.303434 
##  6    10    -2     1 -0.3618123
##  7    10    -2     1 -3.325788 
##  8    10    -2     1 -0.7039727
##  9    10    -2     1 -1.897031 
## 10    10    -2     1  1.001286 
## # … with 830,015 more rows
```

---
class: inverse center middle
# Plot
Add a caption stating the total number of pulizter prize winners across years

---
# Add column for total


```r
pulitzer &lt;- pulitzer %&gt;%
	group_by(newspaper) %&gt;%
	mutate(tot = sum(n))
pulitzer
```

```
## # A tibble: 100 x 4
## # Groups:   newspaper [50]
##    newspaper             year_range     n   tot
##    &lt;chr&gt;                 &lt;chr&gt;      &lt;int&gt; &lt;int&gt;
##  1 USA Today             1990-2003      1     2
##  2 Wall Street Journal   1990-2003     30    50
##  3 New York Times        1990-2003     55   117
##  4 Los Angeles Times     1990-2003     44    85
##  5 Washington Post       1990-2003     52   100
##  6 New York Daily News   1990-2003      4     6
##  7 New York Post         1990-2003      0     0
##  8 Chicago Tribune       1990-2003     23    38
##  9 San Jose Mercury News 1990-2003      4     6
## 10 Newsday               1990-2003     12    18
## # … with 90 more rows
```

---
# Easiest way (imo)
Create a column to represent exactly the label you want.


```r
#install.packages("english")
library(english)
pulitzer &lt;- pulitzer %&gt;%
	mutate(label = 
    glue("{str_to_title(as.english(tot))} Total Pulitzer Awards"))
pulitzer
```

```
## # A tibble: 100 x 5
## # Groups:   newspaper [50]
##    newspaper          year_range     n   tot label                         
##    &lt;chr&gt;              &lt;chr&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;                         
##  1 USA Today          1990-2003      1     2 Two Total Pulitzer Awards     
##  2 Wall Street Journ… 1990-2003     30    50 Fifty Total Pulitzer Awards   
##  3 New York Times     1990-2003     55   117 One Hundred Seventeen Total P…
##  4 Los Angeles Times  1990-2003     44    85 Eighty Five Total Pulitzer Aw…
##  5 Washington Post    1990-2003     52   100 One Hundred Total Pulitzer Aw…
##  6 New York Daily Ne… 1990-2003      4     6 Six Total Pulitzer Awards     
##  7 New York Post      1990-2003      0     0 Zero Total Pulitzer Awards    
##  8 Chicago Tribune    1990-2003     23    38 Thirty Eight Total Pulitzer A…
##  9 San Jose Mercury … 1990-2003      4     6 Six Total Pulitzer Awards     
## 10 Newsday            1990-2003     12    18 Eighteen Total Pulitzer Awards
## # … with 90 more rows
```

---
# Produce one plot


```r
tmp &lt;- pulitzer %&gt;%
	filter(newspaper == "Wall Street Journal") 

ggplot(tmp, aes(year_range, n)) +
	geom_col(aes(fill = n)) +
	scale_fill_distiller(type = "seq", 
	                     limits = c(0, max(pulitzer$n)),
	                     palette = "BuPu",
	                     direction = 1) +
	ylim(0, max(pulitzer$n)) +
	coord_flip() +
	labs(title = "Pulitzer prize winners: Wall Street Journal",
	     x = "Year Range",
	     caption = unique(tmp$label)) 
```

![](w5p1_files/figure-html/plot-cap1-1.png)&lt;!-- --&gt;

---
# Produce all plots
### Nest first


```r
pulitzer %&gt;%
	group_by(newspaper, label) %&gt;%
	nest() 
```

```
## # A tibble: 50 x 3
##    newspaper            label                                data          
##    &lt;chr&gt;                &lt;chr&gt;                                &lt;list&gt;        
##  1 USA Today            Two Total Pulitzer Awards            &lt;tibble [2 × …
##  2 Wall Street Journal  Fifty Total Pulitzer Awards          &lt;tibble [2 × …
##  3 New York Times       One Hundred Seventeen Total Pulitze… &lt;tibble [2 × …
##  4 Los Angeles Times    Eighty Five Total Pulitzer Awards    &lt;tibble [2 × …
##  5 Washington Post      One Hundred Total Pulitzer Awards    &lt;tibble [2 × …
##  6 New York Daily News  Six Total Pulitzer Awards            &lt;tibble [2 × …
##  7 New York Post        Zero Total Pulitzer Awards           &lt;tibble [2 × …
##  8 Chicago Tribune      Thirty Eight Total Pulitzer Awards   &lt;tibble [2 × …
##  9 San Jose Mercury Ne… Six Total Pulitzer Awards            &lt;tibble [2 × …
## 10 Newsday              Eighteen Total Pulitzer Awards       &lt;tibble [2 × …
## # … with 40 more rows
```

---
# Produce plots


```r
final_plots &lt;- pulitzer %&gt;%
	group_by(newspaper, label) %&gt;%
	nest() %&gt;%
	mutate(plots = pmap(list(newspaper, label, data),
*   ~ggplot(..3, aes(year_range, n)) +
    	geom_col(aes(fill = n)) +
    	scale_fill_distiller(type = "seq", 
    	                     limits = c(0, max(pulitzer$n)),
    	                     palette = "BuPu",
    	                     direction = 1) +
    	ylim(0, max(pulitzer$n)) +
    	coord_flip() +
*   	labs(title = glue("Pulitzer prize winners: {..1}"),
    	     x = "Year Range",
*   	     caption = ..2)))
```

---
# Look at a couple plots

.pull-left[

```r
final_plots$plots[[1]]
```

![](w5p1_files/figure-html/p3-1.png)&lt;!-- --&gt;

```r
final_plots$plots[[3]]
```

![](w5p1_files/figure-html/p3-2.png)&lt;!-- --&gt;
]

.pull-right[

```r
final_plots$plots[[2]]
```

![](w5p1_files/figure-html/p4-1.png)&lt;!-- --&gt;

```r
final_plots$plots[[4]]
```

![](w5p1_files/figure-html/p4-2.png)&lt;!-- --&gt;
]

---
# Save all plots

We'll have to iterate across at least two things: (a) file path/names, and (b)
the plots themselves


---
#`walk`

* Why `walk` for saving instead of `map`?

&gt; Walk is an alternative to map that you use when you want to call a function for its side effects, rather than for its return value. You typically do this because you want to render output to the screen or save files to disk - the important thing is the action, not the return value.

\-[r4ds](https://r4ds.had.co.nz/iteration.html#walk)

---
# Example

### Create a directory

```r
fs::dir_create(here::here("plots", "pulitzers"))
```

--
### Create file paths

```r
files &lt;- str_replace_all(tolower(final_plots$newspaper), " ", "-")
paths &lt;- here::here("plots", "pulitzers", glue("{files}.png"))
paths
```

```
##  [1] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/usa-today.png"                   
##  [2] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/wall-street-journal.png"         
##  [3] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/new-york-times.png"              
##  [4] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/los-angeles-times.png"           
##  [5] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/washington-post.png"             
##  [6] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/new-york-daily-news.png"         
##  [7] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/new-york-post.png"               
##  [8] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/chicago-tribune.png"             
##  [9] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/san-jose-mercury-news.png"       
## [10] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/newsday.png"                     
## [11] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/houston-chronicle.png"           
## [12] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/dallas-morning-news.png"         
## [13] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/san-francisco-chronicle.png"     
## [14] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/arizona-republic.png"            
## [15] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/chicago-sun-times.png"           
## [16] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/boston-globe.png"                
## [17] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/atlanta-journal-constitution.png"
## [18] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/newark-star-ledger.png"          
## [19] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/detroit-free-press.png"          
## [20] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/minneapolis-star-tribune.png"    
## [21] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/philadelphia-inquirer.png"       
## [22] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/cleveland-plain-dealer.png"      
## [23] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/san-diego-union-tribune.png"     
## [24] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/tampa-bay-times.png"             
## [25] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/denver-post.png"                 
## [26] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/rocky-mountain-news.png"         
## [27] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/oregonian.png"                   
## [28] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/miami-herald.png"                
## [29] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/orange-county-register.png"      
## [30] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/sacramento-bee.png"              
## [31] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/st.-louis-post-dispatch.png"     
## [32] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/baltimore-sun.png"               
## [33] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/kansas-city-star.png"            
## [34] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/detroit-news.png"                
## [35] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/orlando-sentinel.png"            
## [36] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/south-florida-sun-sentinel.png"  
## [37] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/new-orleans-times-picayune.png"  
## [38] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/columbus-dispatch.png"           
## [39] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/indianapolis-star.png"           
## [40] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/san-antonio-express-news.png"    
## [41] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/pittsburgh-post-gazette.png"     
## [42] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/milwaukee-journal-sentinel.png"  
## [43] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/tampa-tribune.png"               
## [44] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/fort-woth-star-telegram.png"     
## [45] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/boston-herald.png"               
## [46] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/seattle-times.png"               
## [47] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/charlotte-observer.png"          
## [48] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/daily-oklahoman.png"             
## [49] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/louisville-courier-journal.png"  
## [50] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/plots/pulitzers/investor's-buisiness-daily.png"
```

---
# Save plots


```r
walk2(paths, final_plots$plots, ggsave,
      width = 9.5, 
      height = 6.5,
      dpi = 500)
```

---
# Wrap-up
* Lots more to `{purrr}` we weren't able to get to
  + May be interested in `safely`,`reduce`, `modify`, and `pull` and `pluck`
  
* Function programming can *really* help your efficiency, and even if it slows you down initially, I'd recommend striving toward it, because it will ultimately be a huge help.



.center[

### Questions?

]
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "atelier-dune-light",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
