<!DOCTYPE html>
<html>
  <head>
    <title>Batch loading data</title>
    <meta charset="utf-8">
    <meta name="author" content="Daniel Anderson" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/uo.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/uo-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Batch loading data
### Daniel Anderson
### Week 4, Class 1

---




# Agenda
* Discuss the midterm

	+ In-class portion (10 points; please don't stress)

	+ Take home (40 points)

* Review Lab 1

* `map_df` and batch-loading data

* Introduce list columns

---
# Learning objectives
* Understand when `map_df` can and should be applied

* Better understand file paths, and how `{fs}` can help

* Be able to batch load data of a specific type within a mixed-type directory

* Use filenames to pull data

---
class: inverse center middle
# Midterm
### Questions?
### Let's look at the take-home portion

---
class: inverse center middle
# Review Lab 1

---
# `map_df`
* If each iteration returns a data frame, you can use `map_df` to automatically bind all the data frames together.

---
# Example
* Create a function that simulates data


```r
simulate &lt;- function(n, mean = 0, sd = 1) {
	tibble(sample_id = seq_len(n),
	       sample = rnorm(n, mean, sd))
}
simulate(10)
```

```
## # A tibble: 10 x 2
##    sample_id     sample
##        &lt;int&gt;      &lt;dbl&gt;
##  1         1  1.046262 
##  2         2  0.8485443
##  3         3  0.9402922
##  4         4 -0.3246455
##  5         5 -0.1176745
##  6         6  0.4741537
##  7         7  1.209171 
##  8         8  0.7537104
##  9         9  0.1545949
## 10        10  0.2740231
```

---
# Simulation
* Assume we want to vary the sample size from 10 to 150 by increments of 5
* `mean` stays constant at 100, `sd` is constant at 10


--
### Try with `purrr::map`

---

```r
library(tidyverse)
sims &lt;- map(seq(10, 150, 5), simulate, 100, 10)
```

.pull-left[

```r
sims[1]
```

```
## [[1]]
## # A tibble: 10 x 2
##    sample_id    sample
##        &lt;int&gt;     &lt;dbl&gt;
##  1         1 100.2332 
##  2         2 101.4359 
##  3         3  86.00088
##  4         4  85.46788
##  5         5  98.35349
##  6         6 111.2937 
##  7         7 105.5290 
##  8         8 105.4931 
##  9         9 111.1701 
## 10        10 107.7481
```
]

.pull-right[

```r
sims[2]
```

```
## [[1]]
## # A tibble: 15 x 2
##    sample_id    sample
##        &lt;int&gt;     &lt;dbl&gt;
##  1         1  97.82652
##  2         2 104.0230 
##  3         3  93.88380
##  4         4 112.5834 
##  5         5 126.6680 
##  6         6  97.24947
##  7         7  95.56375
##  8         8  90.74221
##  9         9  90.25694
## 10        10  88.33989
## 11        11 108.3766 
## 12        12  96.53626
## 13        13  91.62064
## 14        14  89.15980
## 15        15  77.26699
```
]

---
# Swap for `map_df`
### Try it - what happens?

--

```r
sims_df &lt;- map_df(seq(10, 150, 5), simulate, 100, 10)
sims_df
```

```
## # A tibble: 2,320 x 2
##    sample_id    sample
##        &lt;int&gt;     &lt;dbl&gt;
##  1         1 105.2768 
##  2         2 108.0377 
##  3         3  92.80613
##  4         4 103.8668 
##  5         5  94.49651
##  6         6 121.3657 
##  7         7 118.5711 
##  8         8 112.0742 
##  9         9  88.31388
## 10        10 106.8642 
## # … with 2,310 more rows
```

---
# Notice a problem here


```r
sims_df[1:15, ]
```

```
## # A tibble: 15 x 2
##    sample_id    sample
##        &lt;int&gt;     &lt;dbl&gt;
##  1         1 105.2768 
##  2         2 108.0377 
##  3         3  92.80613
##  4         4 103.8668 
##  5         5  94.49651
##  6         6 121.3657 
##  7         7 118.5711 
##  8         8 112.0742 
##  9         9  88.31388
## 10        10 106.8642 
## 11         1 106.7368 
## 12         2 105.6372 
## 13         3 115.1260 
## 14         4 118.1459 
## 15         5 105.9971
```

---
# `.id` argument


```r
sims_df2 &lt;- map_df(seq(10, 150, 5), simulate, 100, 10, 
                   .id = "iteration")
sims_df2[1:14, ]
```

```
## # A tibble: 14 x 3
##    iteration sample_id    sample
##    &lt;chr&gt;         &lt;int&gt;     &lt;dbl&gt;
##  1 1                 1  92.88833
##  2 1                 2  87.79284
##  3 1                 3 109.8949 
##  4 1                 4  99.09385
##  5 1                 5 117.5216 
##  6 1                 6  90.13943
##  7 1                 7 100.4289 
##  8 1                 8  95.15302
##  9 1                 9  98.92376
## 10 1                10 106.7122 
## 11 2                 1 102.8655 
## 12 2                 2 124.4403 
## 13 2                 3  95.16700
## 14 2                 4 113.5100
```

---
class: middle inverse

&gt; `.id`: Either a string or NULL. If a string, the output will contain a
variable with that name, storing either the name (if .x is named) or the index (if .x is unnamed) of the input. If NULL, the default, no variable will be created.

\- [{purrr} documentation](https://purrr.tidyverse.org/reference/map.html)

---
# setNames


```r
sample_size &lt;- seq(10, 150, 5)
sample_size
```

```
##  [1]  10  15  20  25  30  35  40  45  50  55  60  65  70  75  80  85  90
## [18]  95 100 105 110 115 120 125 130 135 140 145 150
```

```r
sample_size &lt;- setNames(sample_size, seq(10, 150, 5)) 
sample_size
```

```
##  10  15  20  25  30  35  40  45  50  55  60  65  70  75  80  85  90  95 
##  10  15  20  25  30  35  40  45  50  55  60  65  70  75  80  85  90  95 
## 100 105 110 115 120 125 130 135 140 145 150 
## 100 105 110 115 120 125 130 135 140 145 150
```

```r
names(sample_size)
```

```
##  [1] "10"  "15"  "20"  "25"  "30"  "35"  "40"  "45"  "50"  "55"  "60" 
## [12] "65"  "70"  "75"  "80"  "85"  "90"  "95"  "100" "105" "110" "115"
## [23] "120" "125" "130" "135" "140" "145" "150"
```

---
# Try again


```r
sims_df3 &lt;- map_df(sample_size, simulate, 100, 10, 
                   .id = "n")
sims_df3[1:14, ]
```

```
## # A tibble: 14 x 3
##    n     sample_id    sample
##    &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1 10            1  88.00417
##  2 10            2 101.1348 
##  3 10            3 106.8763 
##  4 10            4  98.37171
##  5 10            5 102.7300 
##  6 10            6 124.5342 
##  7 10            7  97.52782
##  8 10            8  93.26488
##  9 10            9 109.4542 
## 10 10           10  79.11504
## 11 15            1 116.7275 
## 12 15            2 119.5852 
## 13 15            3 100.0885 
## 14 15            4 105.3158
```

---
# Another quick example
### `broom::tidy`

* The {broom} package helps us extract model output in a tidy format


```r
lm(tvhours ~ age, gss_cat) %&gt;%
	broom::tidy()
```

```
## # A tibble: 2 x 5
##   term          estimate   std.error statistic       p.value
##   &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 (Intercept) 1.992391   0.06980966   28.54033 4.672161e-173
## 2 age         0.02095679 0.001387361  15.10551 4.689310e- 51
```

---
# Fit separate models by year
### Again - probs not best statistically


```r
 split(gss_cat, gss_cat$year) %&gt;%
 	map_df(~lm(tvhours ~ age, .x) %&gt;%
 	         broom::tidy()) 
```

```
## # A tibble: 16 x 5
##    term          estimate   std.error statistic      p.value
##    &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 (Intercept) 2.080163   0.1709061   12.17138  7.995632e-33
##  2 age         0.01948584 0.003485199  5.591027 2.599011e- 8
##  3 (Intercept) 2.078999   0.2176829    9.550583 1.191266e-20
##  4 age         0.01963575 0.004400292  4.462375 9.137366e- 6
##  5 (Intercept) 1.767990   0.2464509    7.173804 1.531756e-12
##  6 age         0.02386070 0.005031548  4.742218 2.459650e- 6
##  7 (Intercept) 2.096054   0.1496431   14.00702  1.419772e-42
##  8 age         0.01781388 0.002977289  5.983256 2.589482e- 9
##  9 (Intercept) 1.855278   0.2156381    8.603668 2.167351e-17
## 10 age         0.02390720 0.004314567  5.541043 3.628675e- 8
## 11 (Intercept) 2.068914   0.2096397    9.868903 2.896085e-22
## 12 age         0.01989505 0.004086638  4.868317 1.251234e- 6
## 13 (Intercept) 1.878070   0.2258400    8.315932 2.280108e-16
## 14 age         0.02547794 0.004449295  5.726287 1.274840e- 8
## 15 (Intercept) 1.980095   0.1877544   10.54620  3.238043e-25
## 16 age         0.02049066 0.003611900  5.673098 1.650822e- 8
```

---
# .id
In cases like the preceding, `.id` becomes invaluable


```r
split(gss_cat, gss_cat$year) %&gt;%
 	map_df(~lm(tvhours ~ age, .x) %&gt;%
 	         broom::tidy(),
 	       .id = "year") 
```

```
## # A tibble: 16 x 6
##    year  term          estimate   std.error statistic      p.value
##    &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 2000  (Intercept) 2.080163   0.1709061   12.17138  7.995632e-33
##  2 2000  age         0.01948584 0.003485199  5.591027 2.599011e- 8
##  3 2002  (Intercept) 2.078999   0.2176829    9.550583 1.191266e-20
##  4 2002  age         0.01963575 0.004400292  4.462375 9.137366e- 6
##  5 2004  (Intercept) 1.767990   0.2464509    7.173804 1.531756e-12
##  6 2004  age         0.02386070 0.005031548  4.742218 2.459650e- 6
##  7 2006  (Intercept) 2.096054   0.1496431   14.00702  1.419772e-42
##  8 2006  age         0.01781388 0.002977289  5.983256 2.589482e- 9
##  9 2008  (Intercept) 1.855278   0.2156381    8.603668 2.167351e-17
## 10 2008  age         0.02390720 0.004314567  5.541043 3.628675e- 8
## 11 2010  (Intercept) 2.068914   0.2096397    9.868903 2.896085e-22
## 12 2010  age         0.01989505 0.004086638  4.868317 1.251234e- 6
## 13 2012  (Intercept) 1.878070   0.2258400    8.315932 2.280108e-16
## 14 2012  age         0.02547794 0.004449295  5.726287 1.274840e- 8
## 15 2014  (Intercept) 1.980095   0.1877544   10.54620  3.238043e-25
## 16 2014  age         0.02049066 0.003611900  5.673098 1.650822e- 8
```

---
class: inverse center middle
# Batch-loading data
### Please follow along

&lt;img src="img/pfiles_sim.png" width="400px" /&gt;

---
# {fs}

* note - there are base equivalents. `{fs}` is just a a bit better across
platforms and has better defaults. 


```r
# install.packages("fs")
library(fs)
dir_ls("../data")
```

```
## ../data/data-description.html      ../data/data-description.md        
## ../data/data-sim.R                 ../data/g11ELApfiles18_sim.csv     
## ../data/g11Mathpfiles18_sim.csv    ../data/g11Rdgpfiles18_sim.csv     
## ../data/g11Sciencepfiles18_sim.csv ../data/g11Wripfiles18_sim.csv     
## ../data/g3ELApfiles18_sim.csv      ../data/g3Mathpfiles18_sim.csv     
## ../data/g3Rdgpfiles18_sim.csv      ../data/g3Wripfiles18_sim.csv      
## ../data/g4ELApfiles18_sim.csv      ../data/g4Mathpfiles18_sim.csv     
## ../data/g4Rdgpfiles18_sim.csv      ../data/g4Wripfiles18_sim.csv      
## ../data/g5ELApfiles18_sim.csv      ../data/g5Mathpfiles18_sim.csv     
## ../data/g5Rdgpfiles18_sim.csv      ../data/g5Sciencepfiles18_sim.csv  
## ../data/g5Wripfiles18_sim.csv      ../data/g6ELApfiles18_sim.csv      
## ../data/g6Mathpfiles18_sim.csv     ../data/g6Rdgpfiles18_sim.csv      
## ../data/g6Wripfiles18_sim.csv      ../data/g7ELApfiles18_sim.csv      
## ../data/g7Mathpfiles18_sim.csv     ../data/g7Rdgpfiles18_sim.csv      
## ../data/g7Wripfiles18_sim.csv      ../data/g8ELApfiles18_sim.csv      
## ../data/g8Mathpfiles18_sim.csv     ../data/g8Rdgpfiles18_sim.csv      
## ../data/g8Sciencepfiles18_sim.csv  ../data/g8Wripfiles18_sim.csv      
## ../data/pfiles18
```

### Could we apply `map_df` here?

---
# Limit files
* We really only want the `.csv`


```r
dir_ls("../data", glob = "*.csv")
```

```
## ../data/g11ELApfiles18_sim.csv     ../data/g11Mathpfiles18_sim.csv    
## ../data/g11Rdgpfiles18_sim.csv     ../data/g11Sciencepfiles18_sim.csv 
## ../data/g11Wripfiles18_sim.csv     ../data/g3ELApfiles18_sim.csv      
## ../data/g3Mathpfiles18_sim.csv     ../data/g3Rdgpfiles18_sim.csv      
## ../data/g3Wripfiles18_sim.csv      ../data/g4ELApfiles18_sim.csv      
## ../data/g4Mathpfiles18_sim.csv     ../data/g4Rdgpfiles18_sim.csv      
## ../data/g4Wripfiles18_sim.csv      ../data/g5ELApfiles18_sim.csv      
## ../data/g5Mathpfiles18_sim.csv     ../data/g5Rdgpfiles18_sim.csv      
## ../data/g5Sciencepfiles18_sim.csv  ../data/g5Wripfiles18_sim.csv      
## ../data/g6ELApfiles18_sim.csv      ../data/g6Mathpfiles18_sim.csv     
## ../data/g6Rdgpfiles18_sim.csv      ../data/g6Wripfiles18_sim.csv      
## ../data/g7ELApfiles18_sim.csv      ../data/g7Mathpfiles18_sim.csv     
## ../data/g7Rdgpfiles18_sim.csv      ../data/g7Wripfiles18_sim.csv      
## ../data/g8ELApfiles18_sim.csv      ../data/g8Mathpfiles18_sim.csv     
## ../data/g8Rdgpfiles18_sim.csv      ../data/g8Sciencepfiles18_sim.csv  
## ../data/g8Wripfiles18_sim.csv
```

---
# If we want to be extra careful
* Combine with `here::here`. This will be pretty bullet-proof from a
reproducibility perspective.


```r
dir_ls(here::here("data"), glob = "*.csv")
```

```
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11ELApfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Rdgpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Sciencepfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Wripfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3ELApfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3Rdgpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3Wripfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4ELApfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4Rdgpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4Wripfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5ELApfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Rdgpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Sciencepfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Wripfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6ELApfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6Rdgpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6Wripfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7ELApfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7Rdgpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7Wripfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8ELApfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Rdgpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Sciencepfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Wripfiles18_sim.csv
```

---
# Batch load
* Loop through the directories and `import` or `read_csv`


```r
files &lt;- dir_ls(here::here("data"), glob = "*.csv")
batch &lt;- map_df(files, read_csv)
batch
```

```
## # A tibble: 15,945 x 22
##    Entry  Theta Status Count RawScore       SE Infit Infit_Z Outfit
##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1   376 0.3483      1    36       17 0.3629    1.02    0.18   0.96
##  2   364 0.2156      1    36       14 0.3629    1.09    0.71   1.03
##  3   340 4.4752      1    36       35 1.0234    1.01    0.32   0.66
##  4   334 5.7137      0    36       36 1.8371    1       0      1   
##  5   314 3.2773      1    36       33 0.6187    0.89   -0.12   0.72
##  6   146 1.4088      1    36       24 0.3774    1.04    0.48   1.03
##  7   106 3.2773      1    36       33 0.6187    1.09    0.33   1.02
##  8   290 2.9394      1    36       32 0.547800  0.82   -0.71   0.56
##  9   330 1.5541      1    36       25 0.3852    0.82   -1.02   0.74
## 10   251 2.6655      1    36       31 0.5008    1       0      0.67
## # … with 15,935 more rows, and 13 more variables: Outfit_Z &lt;dbl&gt;,
## #   Displacement &lt;dbl&gt;, PointMeasureCorr &lt;dbl&gt;, Weight &lt;dbl&gt;,
## #   ObservMatch &lt;dbl&gt;, ExpectMatch &lt;dbl&gt;, PointMeasureExpected &lt;dbl&gt;,
## #   RMSR &lt;dbl&gt;, WMLE &lt;dbl&gt;, testeventid &lt;dbl&gt;, ssid &lt;dbl&gt;,
## #   asmtprmrydsbltycd &lt;dbl&gt;, asmtscndrydsbltycd &lt;dbl&gt;
```

---
# Problem
* We've lost a lot of info - no way to identify which file is which

### Try to fix it!

---
# Add id


```r
batch2 &lt;- map_df(files, read_csv, .id = "file")
batch2
```

```
## # A tibble: 15,945 x 23
##    file  Entry  Theta Status Count RawScore       SE Infit Infit_Z Outfit
##    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 /Use…   376 0.3483      1    36       17 0.3629    1.02    0.18   0.96
##  2 /Use…   364 0.2156      1    36       14 0.3629    1.09    0.71   1.03
##  3 /Use…   340 4.4752      1    36       35 1.0234    1.01    0.32   0.66
##  4 /Use…   334 5.7137      0    36       36 1.8371    1       0      1   
##  5 /Use…   314 3.2773      1    36       33 0.6187    0.89   -0.12   0.72
##  6 /Use…   146 1.4088      1    36       24 0.3774    1.04    0.48   1.03
##  7 /Use…   106 3.2773      1    36       33 0.6187    1.09    0.33   1.02
##  8 /Use…   290 2.9394      1    36       32 0.547800  0.82   -0.71   0.56
##  9 /Use…   330 1.5541      1    36       25 0.3852    0.82   -1.02   0.74
## 10 /Use…   251 2.6655      1    36       31 0.5008    1       0      0.67
## # … with 15,935 more rows, and 13 more variables: Outfit_Z &lt;dbl&gt;,
## #   Displacement &lt;dbl&gt;, PointMeasureCorr &lt;dbl&gt;, Weight &lt;dbl&gt;,
## #   ObservMatch &lt;dbl&gt;, ExpectMatch &lt;dbl&gt;, PointMeasureExpected &lt;dbl&gt;,
## #   RMSR &lt;dbl&gt;, WMLE &lt;dbl&gt;, testeventid &lt;dbl&gt;, ssid &lt;dbl&gt;,
## #   asmtprmrydsbltycd &lt;dbl&gt;, asmtscndrydsbltycd &lt;dbl&gt;
```

---


```r
batch2 %&gt;%
	count(file)
```

```
## # A tibble: 31 x 2
##    file                                                                   n
##    &lt;chr&gt;                                                              &lt;int&gt;
##  1 /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/d…   453
##  2 /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/d…   460
##  3 /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/d…   453
##  4 /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/d…   438
##  5 /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/d…   453
##  6 /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/d…   540
##  7 /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/d…   536
##  8 /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/d…   540
##  9 /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/d…   540
## 10 /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/d…   585
## # … with 21 more rows
```

* Still not terrifically useful. What can we do?

---
# Step 1

* Remove the `here::here` path from string


```r
batch2 &lt;- batch2 %&gt;%
	mutate(file = str_replace_all(file, here::here("data"), ""))

count(batch2, file)
```

```
## # A tibble: 31 x 2
##    file                            n
##    &lt;chr&gt;                       &lt;int&gt;
##  1 /g11ELApfiles18_sim.csv       453
##  2 /g11Mathpfiles18_sim.csv      460
##  3 /g11Rdgpfiles18_sim.csv       453
##  4 /g11Sciencepfiles18_sim.csv   438
##  5 /g11Wripfiles18_sim.csv       453
##  6 /g3ELApfiles18_sim.csv        540
##  7 /g3Mathpfiles18_sim.csv       536
##  8 /g3Rdgpfiles18_sim.csv        540
##  9 /g3Wripfiles18_sim.csv        540
## 10 /g4ELApfiles18_sim.csv        585
## # … with 21 more rows
```

---
# Pull out pieces you need

* Regular expressions are most powerful here

	+ We haven't talked about them much

* Try [RegExplain](https://www.garrickadenbuie.com/project/regexplain/)

---
# Pull grade

* Note - I'm not expecting you to just suddenly be able to do this. This is more
for illustration. There's also other ways you could extract the same info


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, "/g(\\d?\\d).+", "\\1")) %&gt;%
	select(file, grade)
```

```
## # A tibble: 15,945 x 2
##    file                    grade
##    &lt;chr&gt;                   &lt;chr&gt;
##  1 /g11ELApfiles18_sim.csv 11   
##  2 /g11ELApfiles18_sim.csv 11   
##  3 /g11ELApfiles18_sim.csv 11   
##  4 /g11ELApfiles18_sim.csv 11   
##  5 /g11ELApfiles18_sim.csv 11   
##  6 /g11ELApfiles18_sim.csv 11   
##  7 /g11ELApfiles18_sim.csv 11   
##  8 /g11ELApfiles18_sim.csv 11   
##  9 /g11ELApfiles18_sim.csv 11   
## 10 /g11ELApfiles18_sim.csv 11   
## # … with 15,935 more rows
```

---
# `parse_number`

* In this case `parse_number` also works - but note that it would not work to
extract the year


```r
batch2 %&gt;%
*mutate(grade = parse_number(file)) %&gt;%
	select(file, grade)
```

```
## # A tibble: 15,945 x 2
##    file                    grade
##    &lt;chr&gt;                   &lt;dbl&gt;
##  1 /g11ELApfiles18_sim.csv    11
##  2 /g11ELApfiles18_sim.csv    11
##  3 /g11ELApfiles18_sim.csv    11
##  4 /g11ELApfiles18_sim.csv    11
##  5 /g11ELApfiles18_sim.csv    11
##  6 /g11ELApfiles18_sim.csv    11
##  7 /g11ELApfiles18_sim.csv    11
##  8 /g11ELApfiles18_sim.csv    11
##  9 /g11ELApfiles18_sim.csv    11
## 10 /g11ELApfiles18_sim.csv    11
## # … with 15,935 more rows
```

---
# Extract year

* In this case `parse_number` also works - but note that it would not work to
extract the year


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, "/g(\\d?\\d).+", "\\1"),
*       year = str_replace_all(file, ".+files(\\d\\d)_sim.+", "\\1")) %&gt;%
	select(file, grade, year)
```

```
## # A tibble: 15,945 x 3
##    file                    grade year 
##    &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;
##  1 /g11ELApfiles18_sim.csv 11    18   
##  2 /g11ELApfiles18_sim.csv 11    18   
##  3 /g11ELApfiles18_sim.csv 11    18   
##  4 /g11ELApfiles18_sim.csv 11    18   
##  5 /g11ELApfiles18_sim.csv 11    18   
##  6 /g11ELApfiles18_sim.csv 11    18   
##  7 /g11ELApfiles18_sim.csv 11    18   
##  8 /g11ELApfiles18_sim.csv 11    18   
##  9 /g11ELApfiles18_sim.csv 11    18   
## 10 /g11ELApfiles18_sim.csv 11    18   
## # … with 15,935 more rows
```

---
# Extract Content Area


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, "/g(\\d?\\d).+", "\\1"),
	       year = str_replace_all(file, ".+files(\\d\\d)_sim.+", "\\1"),
*       content = str_replace_all(file, "/g\\d?\\d(.+)pfiles.+", "\\1")) %&gt;%
	select(file, grade, year, content)
```

```
## # A tibble: 15,945 x 4
##    file                    grade year  content
##    &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  
##  1 /g11ELApfiles18_sim.csv 11    18    ELA    
##  2 /g11ELApfiles18_sim.csv 11    18    ELA    
##  3 /g11ELApfiles18_sim.csv 11    18    ELA    
##  4 /g11ELApfiles18_sim.csv 11    18    ELA    
##  5 /g11ELApfiles18_sim.csv 11    18    ELA    
##  6 /g11ELApfiles18_sim.csv 11    18    ELA    
##  7 /g11ELApfiles18_sim.csv 11    18    ELA    
##  8 /g11ELApfiles18_sim.csv 11    18    ELA    
##  9 /g11ELApfiles18_sim.csv 11    18    ELA    
## 10 /g11ELApfiles18_sim.csv 11    18    ELA    
## # … with 15,935 more rows
```

---
# Double checks: grade


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, 
	                               "/g(\\d?\\d).+", 
	                               "\\1"),
	       year = str_replace_all(file, 
	                              ".+files(\\d\\d)_sim.+", 
	                              "\\1"),
	       content = str_replace_all(file, 
	                                 "/g\\d?\\d(.+)pfiles.+", 
	                                 "\\1")) %&gt;%
	select(file, grade, year, content) %&gt;%
	count(grade)
```

```
## # A tibble: 7 x 2
##   grade     n
##   &lt;chr&gt; &lt;int&gt;
## 1 11     2257
## 2 3      2156
## 3 4      2341
## 4 5      2632
## 5 6      2216
## 6 7      1962
## 7 8      2381
```

---
# Double checks: year


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, 
	                               "/g(\\d?\\d).+", 
	                               "\\1"),
	       year = str_replace_all(file, 
	                              ".+files(\\d\\d)_sim.+", 
	                              "\\1"),
	       content = str_replace_all(file, 
	                                 "/g\\d?\\d(.+)pfiles.+", 
	                                 "\\1")) %&gt;%
	select(file, grade, year, content) %&gt;%
	count(year)
```

```
## # A tibble: 1 x 2
##   year      n
##   &lt;chr&gt; &lt;int&gt;
## 1 18    15945
```

---
# Double checks: content


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, 
	                               "/g(\\d?\\d).+", 
	                               "\\1"),
	       year = str_replace_all(file, 
	                              ".+files(\\d\\d)_sim.+", 
	                              "\\1"),
	       content = str_replace_all(file, 
	                                 "/g\\d?\\d(.+)pfiles.+", 
	                                 "\\1")) %&gt;%
	select(file, grade, year, content) %&gt;%
	count(content)
```

```
## # A tibble: 5 x 2
##   content     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 ELA      3627
## 2 Math     3629
## 3 Rdg      3627
## 4 Science  1435
## 5 Wri      3627
```

---
# Finalize


```r
d &lt;- batch2 %&gt;%
	mutate(grade = str_replace_all(file, "/g(\\d?\\d).+", "\\1"),
	       grade = as.integer(grade),
	       year = str_replace_all(file, ".+files(\\d\\d)_sim.+", "\\1"),
	       year = as.integer(grade),
	       content = str_replace_all(file, "/g\\d?\\d(.+)pfiles.+", "\\1")) %&gt;%
	select(-file) %&gt;%
	select(ssid, grade, year, content, testeventid, asmtprmrydsbltycd,
	       asmtscndrydsbltycd, Entry:WMLE)
```

---
# Final product
* In this case, we basically have a tidy data frame already! 

* We've reduced our problem from 31 files to a single file


```r
d
```

```
## # A tibble: 15,945 x 25
##        ssid grade  year content testeventid asmtprmrydsbltycd
##       &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;         &lt;dbl&gt;             &lt;dbl&gt;
##  1 11424133    11    11 ELA          151867                10
##  2 11032405    11    11 ELA          144283                82
##  3 10809295    11    11 ELA          146312                10
##  4 10815457    11    11 ELA          146977                10
##  5 10638008    11    11 ELA          144402                10
##  6 10006109    11    11 ELA          149010                10
##  7  9305807    11    11 ELA          146880                10
##  8 10396942    11    11 ELA          143994                10
##  9 10801367    11    11 ELA          143860                10
## 10 10246495    11    11 ELA          144434                80
## # … with 15,935 more rows, and 19 more variables:
## #   asmtscndrydsbltycd &lt;dbl&gt;, Entry &lt;dbl&gt;, Theta &lt;dbl&gt;, Status &lt;dbl&gt;,
## #   Count &lt;dbl&gt;, RawScore &lt;dbl&gt;, SE &lt;dbl&gt;, Infit &lt;dbl&gt;, Infit_Z &lt;dbl&gt;,
## #   Outfit &lt;dbl&gt;, Outfit_Z &lt;dbl&gt;, Displacement &lt;dbl&gt;,
## #   PointMeasureCorr &lt;dbl&gt;, Weight &lt;dbl&gt;, ObservMatch &lt;dbl&gt;,
## #   ExpectMatch &lt;dbl&gt;, PointMeasureExpected &lt;dbl&gt;, RMSR &lt;dbl&gt;, WMLE &lt;dbl&gt;
```

---
# Quick look at distributions
![](w4p1_files/figure-html/fig-1.png)&lt;!-- --&gt;


---
# Calculate some summary stats


```r
d %&gt;%
	group_by(grade, content, asmtprmrydsbltycd) %&gt;%
	summarize(mean = mean(Theta)) %&gt;%
	spread(content, mean)
```

```
## # A tibble: 77 x 7
## # Groups:   grade [7]
##    grade asmtprmrydsbltycd        ELA       Math         Rdg Science
##    &lt;int&gt;             &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;
##  1     3                 0  0.7972462 -3.38815    0.8141667       NA
##  2     3                10  0.4113426 -0.7972930  0.7428369       NA
##  3     3                20  0.4086200 -1.46495    0.7528571       NA
##  4     3                40 -2.766267  -2.925338  -2               NA
##  5     3                50  1.407710  -0.1980967  0.7541463       NA
##  6     3                60  1.33732   -0.9878643  0.7753333       NA
##  7     3                70  0.2105250 -1.658856  -0.9320000       NA
##  8     3                74  1.504025   0.2944778  0.02600000      NA
##  9     3                80  1.025756  -0.6844064  0.7501333       NA
## 10     3                82  0.3758255 -0.8861006  0.5980100       NA
## # … with 67 more rows, and 1 more variable: Wri &lt;dbl&gt;
```

---
# Backing up a bit

* What if we wanted only math files?


```r
dir_ls(here::here("data"), regexp = "Math")
```

```
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Mathpfiles18_sim.csv
```

---
# Only Grade 5
### You try

--

```r
dir_ls(here::here("data"), regexp = "g5")
```

```
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5ELApfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Mathpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Rdgpfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Sciencepfiles18_sim.csv
## /Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Wripfiles18_sim.csv
```

---
# Base equivalents


```r
list.files(here::here("data"))
```

```
##  [1] "data-description.html"      "data-description.md"       
##  [3] "data-sim.R"                 "g11ELApfiles18_sim.csv"    
##  [5] "g11Mathpfiles18_sim.csv"    "g11Rdgpfiles18_sim.csv"    
##  [7] "g11Sciencepfiles18_sim.csv" "g11Wripfiles18_sim.csv"    
##  [9] "g3ELApfiles18_sim.csv"      "g3Mathpfiles18_sim.csv"    
## [11] "g3Rdgpfiles18_sim.csv"      "g3Wripfiles18_sim.csv"     
## [13] "g4ELApfiles18_sim.csv"      "g4Mathpfiles18_sim.csv"    
## [15] "g4Rdgpfiles18_sim.csv"      "g4Wripfiles18_sim.csv"     
## [17] "g5ELApfiles18_sim.csv"      "g5Mathpfiles18_sim.csv"    
## [19] "g5Rdgpfiles18_sim.csv"      "g5Sciencepfiles18_sim.csv" 
## [21] "g5Wripfiles18_sim.csv"      "g6ELApfiles18_sim.csv"     
## [23] "g6Mathpfiles18_sim.csv"     "g6Rdgpfiles18_sim.csv"     
## [25] "g6Wripfiles18_sim.csv"      "g7ELApfiles18_sim.csv"     
## [27] "g7Mathpfiles18_sim.csv"     "g7Rdgpfiles18_sim.csv"     
## [29] "g7Wripfiles18_sim.csv"      "g8ELApfiles18_sim.csv"     
## [31] "g8Mathpfiles18_sim.csv"     "g8Rdgpfiles18_sim.csv"     
## [33] "g8Sciencepfiles18_sim.csv"  "g8Wripfiles18_sim.csv"     
## [35] "pfiles18"
```

---
# Full path


```r
list.files(here::here("data"), full.names = TRUE)
```

```
##  [1] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/data-description.html"     
##  [2] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/data-description.md"       
##  [3] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/data-sim.R"                
##  [4] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11ELApfiles18_sim.csv"    
##  [5] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Mathpfiles18_sim.csv"   
##  [6] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Rdgpfiles18_sim.csv"    
##  [7] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Sciencepfiles18_sim.csv"
##  [8] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Wripfiles18_sim.csv"    
##  [9] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3ELApfiles18_sim.csv"     
## [10] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3Mathpfiles18_sim.csv"    
## [11] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3Rdgpfiles18_sim.csv"     
## [12] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3Wripfiles18_sim.csv"     
## [13] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4ELApfiles18_sim.csv"     
## [14] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4Mathpfiles18_sim.csv"    
## [15] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4Rdgpfiles18_sim.csv"     
## [16] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4Wripfiles18_sim.csv"     
## [17] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5ELApfiles18_sim.csv"     
## [18] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Mathpfiles18_sim.csv"    
## [19] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Rdgpfiles18_sim.csv"     
## [20] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Sciencepfiles18_sim.csv" 
## [21] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Wripfiles18_sim.csv"     
## [22] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6ELApfiles18_sim.csv"     
## [23] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6Mathpfiles18_sim.csv"    
## [24] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6Rdgpfiles18_sim.csv"     
## [25] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6Wripfiles18_sim.csv"     
## [26] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7ELApfiles18_sim.csv"     
## [27] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7Mathpfiles18_sim.csv"    
## [28] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7Rdgpfiles18_sim.csv"     
## [29] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7Wripfiles18_sim.csv"     
## [30] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8ELApfiles18_sim.csv"     
## [31] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Mathpfiles18_sim.csv"    
## [32] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Rdgpfiles18_sim.csv"     
## [33] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Sciencepfiles18_sim.csv" 
## [34] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Wripfiles18_sim.csv"     
## [35] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/pfiles18"
```

---
# Only csvs


```r
list.files(here::here("data"), 
           full.names = TRUE,
           pattern = "*.csv")
```

```
##  [1] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11ELApfiles18_sim.csv"    
##  [2] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Mathpfiles18_sim.csv"   
##  [3] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Rdgpfiles18_sim.csv"    
##  [4] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Sciencepfiles18_sim.csv"
##  [5] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g11Wripfiles18_sim.csv"    
##  [6] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3ELApfiles18_sim.csv"     
##  [7] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3Mathpfiles18_sim.csv"    
##  [8] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3Rdgpfiles18_sim.csv"     
##  [9] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g3Wripfiles18_sim.csv"     
## [10] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4ELApfiles18_sim.csv"     
## [11] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4Mathpfiles18_sim.csv"    
## [12] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4Rdgpfiles18_sim.csv"     
## [13] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g4Wripfiles18_sim.csv"     
## [14] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5ELApfiles18_sim.csv"     
## [15] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Mathpfiles18_sim.csv"    
## [16] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Rdgpfiles18_sim.csv"     
## [17] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Sciencepfiles18_sim.csv" 
## [18] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g5Wripfiles18_sim.csv"     
## [19] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6ELApfiles18_sim.csv"     
## [20] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6Mathpfiles18_sim.csv"    
## [21] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6Rdgpfiles18_sim.csv"     
## [22] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g6Wripfiles18_sim.csv"     
## [23] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7ELApfiles18_sim.csv"     
## [24] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7Mathpfiles18_sim.csv"    
## [25] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7Rdgpfiles18_sim.csv"     
## [26] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g7Wripfiles18_sim.csv"     
## [27] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8ELApfiles18_sim.csv"     
## [28] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Mathpfiles18_sim.csv"    
## [29] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Rdgpfiles18_sim.csv"     
## [30] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Sciencepfiles18_sim.csv" 
## [31] "/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/data/g8Wripfiles18_sim.csv"
```

---
# Why not use base?
* We could, but `{fs}` plays a little nicer with `{purrr}`

--

```r
files &lt;- list.files(here::here("data"), pattern = "*.csv")
batch3 &lt;- map_df(files, read_csv, .id = "file")
```

```
## Error: 'g11ELApfiles18_sim.csv' does not exist in current working directory ('/Users/Daniel/Teaching/data_sci_specialization/c3-fun_program_r/slides').
```

--
* Need to return full names


```r
files
```

```
##  [1] "g11ELApfiles18_sim.csv"     "g11Mathpfiles18_sim.csv"   
##  [3] "g11Rdgpfiles18_sim.csv"     "g11Sciencepfiles18_sim.csv"
##  [5] "g11Wripfiles18_sim.csv"     "g3ELApfiles18_sim.csv"     
##  [7] "g3Mathpfiles18_sim.csv"     "g3Rdgpfiles18_sim.csv"     
##  [9] "g3Wripfiles18_sim.csv"      "g4ELApfiles18_sim.csv"     
## [11] "g4Mathpfiles18_sim.csv"     "g4Rdgpfiles18_sim.csv"     
## [13] "g4Wripfiles18_sim.csv"      "g5ELApfiles18_sim.csv"     
## [15] "g5Mathpfiles18_sim.csv"     "g5Rdgpfiles18_sim.csv"     
## [17] "g5Sciencepfiles18_sim.csv"  "g5Wripfiles18_sim.csv"     
## [19] "g6ELApfiles18_sim.csv"      "g6Mathpfiles18_sim.csv"    
## [21] "g6Rdgpfiles18_sim.csv"      "g6Wripfiles18_sim.csv"     
## [23] "g7ELApfiles18_sim.csv"      "g7Mathpfiles18_sim.csv"    
## [25] "g7Rdgpfiles18_sim.csv"      "g7Wripfiles18_sim.csv"     
## [27] "g8ELApfiles18_sim.csv"      "g8Mathpfiles18_sim.csv"    
## [29] "g8Rdgpfiles18_sim.csv"      "g8Sciencepfiles18_sim.csv" 
## [31] "g8Wripfiles18_sim.csv"
```

---
# Try again


```r
files &lt;- list.files(here::here("data"), 
                    pattern = "*.csv", 
                    full.names = TRUE)
batch3 &lt;- map_df(files, read_csv, .id = "file")
batch3
```

```
## # A tibble: 15,945 x 23
##    file  Entry  Theta Status Count RawScore       SE Infit Infit_Z Outfit
##    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 1       376 0.3483      1    36       17 0.3629    1.02    0.18   0.96
##  2 1       364 0.2156      1    36       14 0.3629    1.09    0.71   1.03
##  3 1       340 4.4752      1    36       35 1.0234    1.01    0.32   0.66
##  4 1       334 5.7137      0    36       36 1.8371    1       0      1   
##  5 1       314 3.2773      1    36       33 0.6187    0.89   -0.12   0.72
##  6 1       146 1.4088      1    36       24 0.3774    1.04    0.48   1.03
##  7 1       106 3.2773      1    36       33 0.6187    1.09    0.33   1.02
##  8 1       290 2.9394      1    36       32 0.547800  0.82   -0.71   0.56
##  9 1       330 1.5541      1    36       25 0.3852    0.82   -1.02   0.74
## 10 1       251 2.6655      1    36       31 0.5008    1       0      0.67
## # … with 15,935 more rows, and 13 more variables: Outfit_Z &lt;dbl&gt;,
## #   Displacement &lt;dbl&gt;, PointMeasureCorr &lt;dbl&gt;, Weight &lt;dbl&gt;,
## #   ObservMatch &lt;dbl&gt;, ExpectMatch &lt;dbl&gt;, PointMeasureExpected &lt;dbl&gt;,
## #   RMSR &lt;dbl&gt;, WMLE &lt;dbl&gt;, testeventid &lt;dbl&gt;, ssid &lt;dbl&gt;,
## #   asmtprmrydsbltycd &lt;dbl&gt;, asmtscndrydsbltycd &lt;dbl&gt;
```

---
# indexes
* The prior example gave us indexes, rather than the file path. Why?


--
### No names

```r
names(files)
```

```
## NULL
```

* We .bolder[need] the file path! An index isn't nearly as useful.

---
# Base method that works


```r
files &lt;- list.files(here::here("data"), 
                    pattern = "*.csv", 
                    full.names = TRUE) 
files &lt;- setNames(files, files)

batch4 &lt;- map_df(files, read_csv, .id = "file")
batch4
```

```
## # A tibble: 15,945 x 23
##    file  Entry  Theta Status Count RawScore       SE Infit Infit_Z Outfit
##    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 /Use…   376 0.3483      1    36       17 0.3629    1.02    0.18   0.96
##  2 /Use…   364 0.2156      1    36       14 0.3629    1.09    0.71   1.03
##  3 /Use…   340 4.4752      1    36       35 1.0234    1.01    0.32   0.66
##  4 /Use…   334 5.7137      0    36       36 1.8371    1       0      1   
##  5 /Use…   314 3.2773      1    36       33 0.6187    0.89   -0.12   0.72
##  6 /Use…   146 1.4088      1    36       24 0.3774    1.04    0.48   1.03
##  7 /Use…   106 3.2773      1    36       33 0.6187    1.09    0.33   1.02
##  8 /Use…   290 2.9394      1    36       32 0.547800  0.82   -0.71   0.56
##  9 /Use…   330 1.5541      1    36       25 0.3852    0.82   -1.02   0.74
## 10 /Use…   251 2.6655      1    36       31 0.5008    1       0      0.67
## # … with 15,935 more rows, and 13 more variables: Outfit_Z &lt;dbl&gt;,
## #   Displacement &lt;dbl&gt;, PointMeasureCorr &lt;dbl&gt;, Weight &lt;dbl&gt;,
## #   ObservMatch &lt;dbl&gt;, ExpectMatch &lt;dbl&gt;, PointMeasureExpected &lt;dbl&gt;,
## #   RMSR &lt;dbl&gt;, WMLE &lt;dbl&gt;, testeventid &lt;dbl&gt;, ssid &lt;dbl&gt;,
## #   asmtprmrydsbltycd &lt;dbl&gt;, asmtscndrydsbltycd &lt;dbl&gt;
```

---
# My recommendation
* If you're working interactively, no reason not to use `{fs}`

* If you are building functions that take generic paths, might be worth
considering skipping the dependency


--
### Note
I am .bolder[not] saying skip it, but rather that you should .bolder[consider]
whether it is really needed or not.

---
class: inverse center middle

# List columns

---
# Comparing models
Let's say we wanted to fit/compare a set of models for each content area

1. `lm(Theta ~ asmtprmrydsbltycd)`
1. `lm(Theta ~ asmtprmrydsbltycd + asmtscndrydsbltycd)`
1. `lm(Theta ~ asmtprmrydsbltycd + asmtscndrydsbltycd +
	asmtprmrydsbltycd:asmtscndrydsbltycd)`


---
# Split the data

The base method we've been using...


```r
splt_content &lt;- split(d, d$content)
str(splt_content)
```

```
## List of 5
##  $ ELA    :Classes 'tbl_df', 'tbl' and 'data.frame':	3627 obs. of  25 variables:
##   ..$ ssid                : num [1:3627] 11424133 11032405 10809295 10815457 10638008 ...
##   ..$ grade               : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ year                : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ content             : chr [1:3627] "ELA" "ELA" "ELA" "ELA" ...
##   ..$ testeventid         : num [1:3627] 151867 144283 146312 146977 144402 ...
##   ..$ asmtprmrydsbltycd   : num [1:3627] 10 82 10 10 10 10 10 10 10 80 ...
##   ..$ asmtscndrydsbltycd  : num [1:3627] 80 50 20 0 10 0 0 0 0 0 ...
##   ..$ Entry               : num [1:3627] 376 364 340 334 314 146 106 290 330 251 ...
##   ..$ Theta               : num [1:3627] 0.348 0.216 4.475 5.714 3.277 ...
##   ..$ Status              : num [1:3627] 1 1 1 0 1 1 1 1 1 1 ...
##   ..$ Count               : num [1:3627] 36 36 36 36 36 36 36 36 36 36 ...
##   ..$ RawScore            : num [1:3627] 17 14 35 36 33 24 33 32 25 31 ...
##   ..$ SE                  : num [1:3627] 0.363 0.363 1.023 1.837 0.619 ...
##   ..$ Infit               : num [1:3627] 1.02 1.09 1.01 1 0.89 1.04 1.09 0.82 0.82 1 ...
##   ..$ Infit_Z             : num [1:3627] 0.18 0.71 0.32 0 -0.12 0.48 0.33 -0.71 -1.02 0 ...
##   ..$ Outfit              : num [1:3627] 0.96 1.03 0.66 1 0.72 1.03 1.02 0.56 0.74 0.67 ...
##   ..$ Outfit_Z            : num [1:3627] -0.11 0.48 0.17 0 -0.37 0.21 0.28 -0.91 -1.09 -0.07 ...
##   ..$ Displacement        : num [1:3627] 0.0016 0.0016 0.0023 0.0024 0.0022 0.0018 0.0022 0.0021 0.0019 0.0021 ...
##   ..$ PointMeasureCorr    : num [1:3627] 0.34 0.3 0.14 0 0.38 0.29 0.15 0.5 0.51 0.26 ...
##   ..$ Weight              : num [1:3627] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ ObservMatch         : num [1:3627] 61.1 66.7 97.2 100 91.7 69.4 91.7 88.9 69.4 86.1 ...
##   ..$ ExpectMatch         : num [1:3627] 66.1 66.5 97.2 100 91.7 69.9 91.7 88.9 72 86.1 ...
##   ..$ PointMeasureExpected: num [1:3627] 0.38 0.38 0.12 0 0.2 0.34 0.2 0.23 0.33 0.25 ...
##   ..$ RMSR                : num [1:3627] 0.46 0.46 0.16 0 0.25 0.42 0.29 0.29 0.35 0.32 ...
##   ..$ WMLE                : num [1:3627] 0.483 0.483 4 5.714 3.133 ...
##  $ Math   :Classes 'tbl_df', 'tbl' and 'data.frame':	3629 obs. of  25 variables:
##   ..$ ssid                : num [1:3629] 7681755 10226532 7632126 9661379 13985973 ...
##   ..$ grade               : int [1:3629] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ year                : int [1:3629] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ content             : chr [1:3629] "Math" "Math" "Math" "Math" ...
##   ..$ testeventid         : num [1:3629] 148914 144360 143696 149006 149710 ...
##   ..$ asmtprmrydsbltycd   : num [1:3629] 10 82 82 70 10 80 80 80 80 80 ...
##   ..$ asmtscndrydsbltycd  : num [1:3629] 40 0 0 0 80 0 10 0 50 0 ...
##   ..$ Entry               : num [1:3629] 97 238 43 132 405 292 210 134 303 333 ...
##   ..$ Theta               : num [1:3629] -4.724 -4.724 0.132 1.311 0.899 ...
##   ..$ Status              : num [1:3629] -1 -1 1 1 1 1 1 1 1 1 ...
##   ..$ Count               : num [1:3629] 36 36 36 36 36 36 36 36 36 36 ...
##   ..$ RawScore            : num [1:3629] 0 0 16 25 22 22 15 27 26 27 ...
##   ..$ SE                  : num [1:3629] 1.839 1.839 0.359 0.38 0.362 ...
##   ..$ Infit               : num [1:3629] 1 1 1.07 0.81 1.16 0.84 0.89 0.92 1.06 0.93 ...
##   ..$ Infit_Z             : num [1:3629] 0 0 0.59 -0.86 1.44 -1.5 -0.89 -0.24 0.32 -0.35 ...
##   ..$ Outfit              : num [1:3629] 1 1 1.1 0.72 1.33 0.75 0.92 0.71 0.78 0.76 ...
##   ..$ Outfit_Z            : num [1:3629] 0 0 0.69 -1.09 1.55 -1.69 -0.96 -0.56 -0.12 -0.49 ...
##   ..$ Displacement        : num [1:3629] -7e-04 -7e-04 4e-04 5e-04 5e-04 5e-04 4e-04 5e-04 5e-04 5e-04 ...
##   ..$ PointMeasureCorr    : num [1:3629] 0 0 0.27 0.58 0.04 0.54 0.47 0.39 0.27 0.4 ...
##   ..$ Weight              : num [1:3629] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ ObservMatch         : num [1:3629] 100 100 61.1 72.2 47.2 66.7 72.2 69.4 75 75 ...
##   ..$ ExpectMatch         : num [1:3629] 100 100 66.2 70.3 66 66 67.2 75 72.5 75 ...
##   ..$ PointMeasureExpected: num [1:3629] 0 0 0.35 0.3 0.33 0.33 0.36 0.28 0.29 0.28 ...
##   ..$ RMSR                : num [1:3629] 0 0 0.48 0.4 0.5 0.42 0.44 0.41 0.4 0.39 ...
##   ..$ WMLE                : num [1:3629] -4.724 -4.724 0.139 1.288 0.888 ...
##  $ Rdg    :Classes 'tbl_df', 'tbl' and 'data.frame':	3627 obs. of  25 variables:
##   ..$ ssid                : num [1:3627] 10163468 10216650 10986642 10602593 7641990 ...
##   ..$ grade               : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ year                : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ content             : chr [1:3627] "Rdg" "Rdg" "Rdg" "Rdg" ...
##   ..$ testeventid         : num [1:3627] 143042 145340 147700 143348 147151 ...
##   ..$ asmtprmrydsbltycd   : num [1:3627] 10 10 10 10 80 10 10 10 70 10 ...
##   ..$ asmtscndrydsbltycd  : num [1:3627] 50 40 0 0 50 80 0 0 90 0 ...
##   ..$ Entry               : num [1:3627] 183 219 351 318 46 58 401 259 175 85 ...
##   ..$ Theta               : num [1:3627] -1.39 0.12 1.3 2.72 0.12 -4.01 2.72 4.73 1.05 -2.72 ...
##   ..$ Status              : num [1:3627] 1 1 1 1 1 -1 1 0 1 1 ...
##   ..$ Count               : num [1:3627] 19 19 19 19 19 19 19 19 19 19 ...
##   ..$ RawScore            : num [1:3627] 4 8 13 17 8 0 17 19 12 1 ...
##   ..$ SE                  : num [1:3627] 0.66 0.49 0.51 0.76 0.49 1.86 0.76 1.84 0.49 1.06 ...
##   ..$ Infit               : num [1:3627] 0.73 1.06 1.11 0.97 0.89 1 0.92 1 0.93 0.63 ...
##   ..$ Infit_Z             : num [1:3627] -0.54 0.51 0.8 0.14 -0.9 0 0.06 0 -0.49 -0.19 ...
##   ..$ Outfit              : num [1:3627] 0.67 1.02 1.14 0.96 0.83 1 0.72 1 0.93 0.18 ...
##   ..$ Outfit_Z            : num [1:3627] -0.67 0.43 0.43 0.16 -0.6 0 -0.12 0 -0.09 -0.74 ...
##   ..$ Displacement        : num [1:3627] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ PointMeasureCorr    : num [1:3627] 0.69 0.2 0.04 0.15 0.48 0 0.29 0 0.35 0.75 ...
##   ..$ Weight              : num [1:3627] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ ObservMatch         : num [1:3627] 84.2 63.2 63.2 89.5 78.9 100 89.5 100 73.7 94.7 ...
##   ..$ ExpectMatch         : num [1:3627] 85.1 64.2 68.6 89.5 64.2 100 89.5 100 64.3 94.7 ...
##   ..$ PointMeasureExpected: num [1:3627] 0.31 0.3 0.23 0.14 0.3 0 0.14 0 0.25 0.24 ...
##   ..$ RMSR                : num [1:3627] 0.34 0.47 0.48 0.31 0.43 0 0.29 0 0.45 0.17 ...
##   ..$ WMLE                : num [1:3627] -1.26 0.14 1.26 2.5 0.14 -4.01 2.5 4.73 1.02 -2.27 ...
##  $ Science:Classes 'tbl_df', 'tbl' and 'data.frame':	1435 obs. of  25 variables:
##   ..$ ssid                : num [1:1435] 10216766 10216650 10218688 10609008 10396942 ...
##   ..$ grade               : int [1:1435] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ year                : int [1:1435] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ content             : chr [1:1435] "Science" "Science" "Science" "Science" ...
##   ..$ testeventid         : num [1:1435] 144587 146426 149037 150170 149031 ...
##   ..$ asmtprmrydsbltycd   : num [1:1435] 82 60 82 80 10 10 82 82 80 10 ...
##   ..$ asmtscndrydsbltycd  : num [1:1435] 10 10 0 0 0 60 0 0 0 0 ...
##   ..$ Entry               : num [1:1435] 209 210 208 292 271 137 250 88 249 51 ...
##   ..$ Theta               : num [1:1435] 2.65 2.65 2.38 2.65 4.17 ...
##   ..$ Status              : num [1:1435] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ Count               : num [1:1435] 36 36 36 36 36 36 36 36 36 36 ...
##   ..$ RawScore            : num [1:1435] 32 32 31 32 35 9 35 16 35 28 ...
##   ..$ SE                  : num [1:1435] 0.544 0.544 0.497 0.544 1.021 ...
##   ..$ Infit               : num [1:1435] 0.86 1.07 0.94 0.96 1.01 1.18 1.04 1.14 1.09 0.96 ...
##   ..$ Infit_Z             : num [1:1435] -0.04 0.3 -0.08 0.07 0.31 0.73 0.36 1.26 0.37 -0.12 ...
##   ..$ Outfit              : num [1:1435] 0.58 1.01 0.59 0.73 0.79 1.32 1.25 1.15 1.88 0.86 ...
##   ..$ Outfit_Z            : num [1:1435] -0.57 0.17 -0.65 -0.3 0.23 1.28 0.55 1.02 1.54 -0.16 ...
##   ..$ Displacement        : num [1:1435] 0.0016 0.0016 0.0016 0.0016 0.0016 0.0006 0.0016 0.0009 0.0016 0.0014 ...
##   ..$ PointMeasureCorr    : num [1:1435] 0.36 0.14 0.4 0.28 0.14 0 0 0.18 -0.13 0.36 ...
##   ..$ Weight              : num [1:1435] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ ObservMatch         : num [1:1435] 88.9 88.9 86.1 88.9 97.2 66.7 97.2 55.6 97.2 75 ...
##   ..$ ExpectMatch         : num [1:1435] 88.9 88.9 86.1 88.9 97.2 80.5 97.2 63.3 97.2 78.2 ...
##   ..$ PointMeasureExpected: num [1:1435] 0.22 0.22 0.24 0.22 0.12 0.27 0.12 0.33 0.12 0.27 ...
##   ..$ RMSR                : num [1:1435] 0.28 0.31 0.32 0.3 0.16 0.48 0.17 0.51 0.17 0.43 ...
##   ..$ WMLE                : num [1:1435] 2.54 2.54 2.3 2.54 3.69 ...
##  $ Wri    :Classes 'tbl_df', 'tbl' and 'data.frame':	3627 obs. of  25 variables:
##   ..$ ssid                : num [1:3627] 9993495 15727459 18072763 6709516 10986642 ...
##   ..$ grade               : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ year                : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ content             : chr [1:3627] "Wri" "Wri" "Wri" "Wri" ...
##   ..$ testeventid         : num [1:3627] 144372 147379 149997 146506 151244 ...
##   ..$ asmtprmrydsbltycd   : num [1:3627] 10 80 82 0 90 80 82 82 82 40 ...
##   ..$ asmtscndrydsbltycd  : num [1:3627] 60 0 0 80 0 0 0 50 20 0 ...
##   ..$ Entry               : num [1:3627] 142 412 444 1 348 402 132 242 300 444 ...
##   ..$ Theta               : num [1:3627] 5.01 3.68 5.01 2.17 3.68 3.68 5.01 2.78 5.01 5.01 ...
##   ..$ Status              : num [1:3627] 0 1 0 1 1 1 0 1 0 0 ...
##   ..$ Count               : num [1:3627] 13 13 13 13 13 13 13 13 13 13 ...
##   ..$ RawScore            : num [1:3627] 13 12 13 10 12 12 13 11 13 13 ...
##   ..$ SE                  : num [1:3627] 1.87 1.09 1.87 0.74 1.09 1.09 1.87 0.84 1.87 1.87 ...
##   ..$ Infit               : num [1:3627] 1 0.88 1 1.14 0.88 0.93 1 0.88 1 1 ...
##   ..$ Infit_Z             : num [1:3627] 0 0.11 0 0.44 0.11 0.01 0 0.11 0 0 ...
##   ..$ Outfit              : num [1:3627] 1 0.36 1 0.67 0.36 0.52 1 0.54 1 2.63 ...
##   ..$ Outfit_Z            : num [1:3627] 0 -0.14 0 0.01 -0.14 -0.41 0 -0.06 0 1.43 ...
##   ..$ Displacement        : num [1:3627] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ PointMeasureCorr    : num [1:3627] 0 0.41 0 0.35 0.41 0.5 0 0.47 0 0 ...
##   ..$ Weight              : num [1:3627] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ ObservMatch         : num [1:3627] 100 92.3 100 76.9 92.3 92.3 100 84.6 100 100 ...
##   ..$ ExpectMatch         : num [1:3627] 100 92.3 100 79.7 92.3 92.3 100 84.6 100 100 ...
##   ..$ PointMeasureExpected: num [1:3627] 0 0.28 0 0.44 0.28 0.28 0 0.38 0 0 ...
##   ..$ RMSR                : num [1:3627] 0 0.24 0 0.37 0.24 0.27 0 0.31 0 0 ...
##   ..$ WMLE                : num [1:3627] 5.01 3.26 5.01 2.08 3.26 3.26 5.01 2.61 5.01 5.01 ...
```

---
# We could use this method


```r
m1 &lt;- map(splt_content, ~lm(Theta ~ asmtprmrydsbltycd, 
          									data = .x))
m2 &lt;- map(splt_content, ~lm(Theta ~ asmtprmrydsbltycd + 
                               			asmtscndrydsbltycd, 
														data = .x))
m3 &lt;- map(splt_content, ~lm(Theta ~ asmtprmrydsbltycd*asmtscndrydsbltycd, 
          									data = .x))
```

* We could then go through and conduct tests to see which model was better, etc.


---
# Alternative
* Create a data frame with a list column


```r
d %&gt;%
	nest(-content)
```

```
## # A tibble: 5 x 2
##   content data                 
##   &lt;chr&gt;   &lt;list&gt;               
## 1 ELA     &lt;tibble [3,627 × 24]&gt;
## 2 Math    &lt;tibble [3,629 × 24]&gt;
## 3 Rdg     &lt;tibble [3,627 × 24]&gt;
## 4 Science &lt;tibble [1,435 × 24]&gt;
## 5 Wri     &lt;tibble [3,627 × 24]&gt;
```

---
# Add model list column


```r
mods &lt;- d %&gt;%
	nest(-content) %&gt;%
	mutate(m1 = map(data, ~lm(Theta ~ asmtprmrydsbltycd, 
          									data = .x)),
         m2 = map(data, ~lm(Theta ~ asmtprmrydsbltycd + asmtscndrydsbltycd, 
          									data = .x)),
         m3 = map(data, ~lm(Theta ~ asmtprmrydsbltycd*asmtscndrydsbltycd, 
          									data = .x)))
mods
```

```
## # A tibble: 5 x 5
##   content data                  m1       m2       m3      
##   &lt;chr&gt;   &lt;list&gt;                &lt;list&gt;   &lt;list&gt;   &lt;list&gt;  
## 1 ELA     &lt;tibble [3,627 × 24]&gt; &lt;S3: lm&gt; &lt;S3: lm&gt; &lt;S3: lm&gt;
## 2 Math    &lt;tibble [3,629 × 24]&gt; &lt;S3: lm&gt; &lt;S3: lm&gt; &lt;S3: lm&gt;
## 3 Rdg     &lt;tibble [3,627 × 24]&gt; &lt;S3: lm&gt; &lt;S3: lm&gt; &lt;S3: lm&gt;
## 4 Science &lt;tibble [1,435 × 24]&gt; &lt;S3: lm&gt; &lt;S3: lm&gt; &lt;S3: lm&gt;
## 5 Wri     &lt;tibble [3,627 × 24]&gt; &lt;S3: lm&gt; &lt;S3: lm&gt; &lt;S3: lm&gt;
```

---
# Part of the benefit
### It's a normal data frame!


```r
mods %&gt;%
	gather(model, output, m1:m3)
```

```
## # A tibble: 15 x 4
##    content data                  model output  
##    &lt;chr&gt;   &lt;list&gt;                &lt;chr&gt; &lt;list&gt;  
##  1 ELA     &lt;tibble [3,627 × 24]&gt; m1    &lt;S3: lm&gt;
##  2 Math    &lt;tibble [3,629 × 24]&gt; m1    &lt;S3: lm&gt;
##  3 Rdg     &lt;tibble [3,627 × 24]&gt; m1    &lt;S3: lm&gt;
##  4 Science &lt;tibble [1,435 × 24]&gt; m1    &lt;S3: lm&gt;
##  5 Wri     &lt;tibble [3,627 × 24]&gt; m1    &lt;S3: lm&gt;
##  6 ELA     &lt;tibble [3,627 × 24]&gt; m2    &lt;S3: lm&gt;
##  7 Math    &lt;tibble [3,629 × 24]&gt; m2    &lt;S3: lm&gt;
##  8 Rdg     &lt;tibble [3,627 × 24]&gt; m2    &lt;S3: lm&gt;
##  9 Science &lt;tibble [1,435 × 24]&gt; m2    &lt;S3: lm&gt;
## 10 Wri     &lt;tibble [3,627 × 24]&gt; m2    &lt;S3: lm&gt;
## 11 ELA     &lt;tibble [3,627 × 24]&gt; m3    &lt;S3: lm&gt;
## 12 Math    &lt;tibble [3,629 × 24]&gt; m3    &lt;S3: lm&gt;
## 13 Rdg     &lt;tibble [3,627 × 24]&gt; m3    &lt;S3: lm&gt;
## 14 Science &lt;tibble [1,435 × 24]&gt; m3    &lt;S3: lm&gt;
## 15 Wri     &lt;tibble [3,627 × 24]&gt; m3    &lt;S3: lm&gt;
```

---
# Extract all `\(R^2\)`


```r
mods %&gt;%
	gather(model, output, m1:m3) %&gt;%
	mutate(r2 = map_dbl(output, ~summary(.x)$r.squared))
```

```
## # A tibble: 15 x 5
##    content data                  model output            r2
##    &lt;chr&gt;   &lt;list&gt;                &lt;chr&gt; &lt;list&gt;         &lt;dbl&gt;
##  1 ELA     &lt;tibble [3,627 × 24]&gt; m1    &lt;S3: lm&gt; 6.394420e-4
##  2 Math    &lt;tibble [3,629 × 24]&gt; m1    &lt;S3: lm&gt; 3.151964e-7
##  3 Rdg     &lt;tibble [3,627 × 24]&gt; m1    &lt;S3: lm&gt; 7.138071e-5
##  4 Science &lt;tibble [1,435 × 24]&gt; m1    &lt;S3: lm&gt; 4.447519e-5
##  5 Wri     &lt;tibble [3,627 × 24]&gt; m1    &lt;S3: lm&gt; 1.162675e-3
##  6 ELA     &lt;tibble [3,627 × 24]&gt; m2    &lt;S3: lm&gt; 9.458086e-4
##  7 Math    &lt;tibble [3,629 × 24]&gt; m2    &lt;S3: lm&gt; 3.677477e-5
##  8 Rdg     &lt;tibble [3,627 × 24]&gt; m2    &lt;S3: lm&gt; 3.865820e-4
##  9 Science &lt;tibble [1,435 × 24]&gt; m2    &lt;S3: lm&gt; 6.533086e-4
## 10 Wri     &lt;tibble [3,627 × 24]&gt; m2    &lt;S3: lm&gt; 5.590844e-3
## 11 ELA     &lt;tibble [3,627 × 24]&gt; m3    &lt;S3: lm&gt; 1.035428e-3
## 12 Math    &lt;tibble [3,629 × 24]&gt; m3    &lt;S3: lm&gt; 2.056597e-3
## 13 Rdg     &lt;tibble [3,627 × 24]&gt; m3    &lt;S3: lm&gt; 1.889568e-3
## 14 Science &lt;tibble [1,435 × 24]&gt; m3    &lt;S3: lm&gt; 8.766337e-4
## 15 Wri     &lt;tibble [3,627 × 24]&gt; m3    &lt;S3: lm&gt; 6.002932e-3
```

---
# Plot


```r
mods %&gt;%
	gather(model, output, m1:m3) %&gt;%
	mutate(r2 = map_dbl(output, ~summary(.x)$r.squared)) %&gt;%
ggplot(aes(model, r2)) +
	geom_col(aes(fill = model)) +
	facet_wrap(~content) +
	guides(fill = "none") +
	scale_fill_brewer(palette = "Set2")
```

![](w4p1_files/figure-html/model-plot-1.png)&lt;!-- --&gt;

---
# Summary

* Batch processing is .bolder[really] powerful

* Much of the tools we've learned in the past can be applied once we get the
data in a more workable format

* List columns are also .bolder[really] nice for organization and using our data
frame toolkit


--
### Wednesday
* We'll talk more about list columns


--
### Any time left?
* Let's get started on the midterm
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "atelier-dune-light",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
